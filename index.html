<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø®ÙÙŠÙ â€“ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Tahoma;background:#111;color:#eee;text-align:center;padding:20px}
    textarea{width:90%;height:180px;margin:10px auto;font-size:14px;padding:8px;border-radius:6px;border:none;resize:vertical}
    button{padding:10px 24px;font-size:17px;background:#0ebeff;color:#000;border:none;border-radius:6px;cursor:pointer;margin:4px}
    #result,#follow{text-align:right;white-space:pre-line;font-size:15px;line-height:1.9}
    .sig-sell{color:#ff4757;font-weight:bold}
    .sig-buy{color:#2ed573;font-weight:bold}
    .block{border:1px solid #444;margin:6px 0;padding:8px;border-radius:6px;background:#1b1b1b}
    .settings{margin:15px auto;width:fit-fit;background:#222;padding:8px 14px;border-radius:6px}
    input[type=number]{width:70px;padding:4px;border:none;border-radius:4px}
  </style>
</head>
<body>

  <h1>ğŸ“Š Ø®ÙÙŠÙ â€“ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±</h1>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
  <div class="settings">
    Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± â‰¥ <input id="minVol" type="number" value="1.0" step="0.1"> Éƒ &nbsp;
    Ø¨ÙŠØ¹ â‰¥ <input id="sellThr" type="number" value="70"> % &nbsp;
    ØªØºÙŠÙ‘Ø± Ø³Ø¹Ø±ÙŠ â‰¤ <input id="maxChg" type="number" value="0.005" step="0.001">
  </div>

  <textarea id="raw" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù‡Ù†Ø§ (ÙŠÙ…ÙƒÙ† Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ø±Ø³Ø§Ù„Ø©)..."></textarea>
  <br>
  <button onclick="analyze()">ğŸ” Ø¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª</button>
  <button onclick="followUp()">ğŸ“ˆ ØªØ§Ø¨Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±</button>

  <div id="result"></div>
  <div id="follow"></div>

  <script>
    let lastSignals=[]; // Ù†Ø®Ø²Ù† Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ù„Ø­Ø¸Ø© Ø§Ù„Ø¸Ù‡ÙˆØ±

    function analyze(){
      const raw=document.getElementById("raw").value;
      if(!raw.trim()){alert("Ø£Ù„ØµÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ù‹Ø§");return;}
      const lines=raw.split('\n');

      const minVol   =parseFloat(document.getElementById("minVol").value);
      const sellThr  =parseInt(document.getElementById("sellThr").value);
      const maxChg   =parseFloat(document.getElementById("maxChg").value);

      lastSignals=[]; // ØªÙØ±ÙŠØº Ø³Ø§Ø¨Ù‚
      let i=0;

      while(i<lines.length){
        const l=lines[i];
        const volMatch=l.match(/([\d.]+)Éƒ\s+volume\s+in/);
        if(volMatch){
          let j=i+1, sellPct=null, buyPct=null, priceLine=null;
          while(j<lines.length && !priceLine){
            const s=lines[j];
            if(!sellPct){const m=s.match(/Sell\s*\[(-?\d+)%\]/); if(m)sellPct=parseInt(m[1]);}
            if(!buyPct) {const m=s.match(/Buy\s*\[(-?\d+)%\]/);  if(m)buyPct =parseInt(m[1]);}
            if(!priceLine)priceLine=s.match(/Price:([\d.]+)â†’([\d.]+)/);
            j++;
          }
          const vol=parseFloat(volMatch[1]);
          const symbolMatch=l.match(/^â”Œ?#?(\w+)/);
          const symbol=symbolMatch?symbolMatch[1]:"UNKN";

          if(priceLine && vol>=minVol){
            const p1=parseFloat(priceLine[1]);
            const p2=parseFloat(priceLine[2]);
            const chg=Math.abs(p2-p1);
            // Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ Ø®ÙÙŠÙØ©
            if(sellPct!==null && sellPct>=sellThr && chg<=maxChg){
              lastSignals.push({symbol,type:'sell',price:p2,vol,line:l.trim()});
            }
            // Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ø®ÙÙŠÙØ© (Ù†Ø³Ø¨Ø© Ø´Ø±Ø§Ø¡ Ø¹Ø§Ù„ÙŠØ© + Ø­Ø¬Ù… ÙƒØ¨ÙŠØ±)
            if(buyPct!==null && buyPct>=sellThr && chg<=maxChg){
              lastSignals.push({symbol,type:'buy',price:p2,vol,line:l.trim()});
            }
          }
        }
        i++;
      }

      let html="";
      lastSignals.forEach(sg=>{
        const cls= sg.type==='sell' ? 'sig-sell':'sig-buy';
        const txt= sg.type==='sell' ? 'Ø¨ÙŠØ¹ Ø®ÙÙŠÙ':'Ø´Ø±Ø§Ø¡ Ø®ÙÙŠÙ';
        html+=`<div class="block"><span class="${cls}">ğŸ”¸ ${txt} â€“ ${sg.symbol}</span><br>
               Ø³Ø¹Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø©: ${sg.price} | Ø­Ø¬Ù…: ${sg.vol}Éƒ<br>
               <small>${sg.line}</small></div>`;
      });
      document.getElementById("result").innerHTML= html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©";
      document.getElementById("follow").textContent=""; // ØªÙØ±ÙŠØº Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
    }

    // Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø³ÙŠØ·Ø©: Ø§Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ³Ø¹Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø©
    function followUp(){
      if(lastSignals.length===0){alert("Ø§Ø¶ØºØ· Â«Ø¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø§ØªÂ» Ø£ÙˆÙ„Ù‹Ø§");return;}
      const raw=document.getElementById("raw").value;
      const lines=raw.split('\n');
      let rep="";
      lastSignals.forEach(sg=>{
        // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø£Ø­Ø¯Ø« Ø³Ø¹Ø± Ù„Ù†ÙØ³ Ø§Ù„Ø±Ù…Ø² Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ØµÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        for(const l of lines){
          const p=l.match(/Price:[\d.]+\s*â†’\s*([\d.]+)/);
          if(l.includes(sg.symbol) && p){
            const cur=parseFloat(p[1]);
            const diff= cur-sg.price;
            const points= diff.toFixed(4);
            const dir= diff>0 ? "ğŸ“ˆ":"ğŸ“‰";
            rep+=`${sg.symbol}  ${dir}  ${points} Ù†Ù‚Ø·Ø© Ù…Ù† Ø³Ø¹Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø© (${sg.price})\n`;
            break;
          }
        }
      });
      document.getElementById("follow").textContent= rep ||"Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø± Ø­Ø¯ÙŠØ«Ø© Ù„Ù„Ø±Ù…ÙˆØ²";
    }
  </script>

</body>
</html>
