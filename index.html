<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Telegram Multi-Data Screener</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Tahoma,sans-serif;background:#111;color:#eee;text-align:center;padding:20px}
    textarea{width:90%;height:200px;margin:15px auto;font-size:14px;padding:10px;border-radius:6px;border:none;resize:vertical}
    button{padding:12px 28px;font-size:18px;background:#0ebeff;color:#000;border:none;border-radius:6px;cursor:pointer}
    #result{margin-top:25px;text-align:right;white-space:pre-line;font-size:15px;line-height:1.8}
    .sig-sell{color:#ff4757;font-weight:bold}
    .sig-buy {color:#2ed573;font-weight:bold}
    .block{border:1px solid #444;margin:8px 0;padding:8px;border-radius:6px;background:#1b1b1b}
  </style>
</head>
<body>

  <h1>📊 Telegram Multi-Data Screener</h1>
  <textarea id="raw" placeholder="الصق جميع الرسائل الواردة هنا..."></textarea>
  <br>
  <button onclick="analyze()">🔍 حلل الآن</button>
  <div id="result"></div>

  <script>
    function analyze(){
      const raw=document.getElementById("raw").value;
      if(!raw.trim()){alert("الرجاء لصق البيانات أولًا");return;}
      const lines=raw.split('\n');

      const records=[];   // كلُّ التوصيات المستخرجة
      let i=0;

      while(i<lines.length){
        const l=lines[i];
        // السطر الأساسي الذي يحتوي على الحجم
        const volMatch=l.match(/([\d.]+)Ƀ\s+volume\s+in/);
        if(volMatch){
          let j=i+1, sellPct=null, buyPct=null, priceLine=null;

          // ابحث عن نسبة البيع/الشراء في السطور التالية
          while(j<lines.length && !priceLine){
            const pctSell=lines[j].match(/Sell\s*\[(-?\d+)%\]/);
            const pctBuy=lines[j].match(/Buy\s*\[(-?\d+)%\]/);
            if(pctSell){sellPct=parseInt(pctSell[1]);}
            if(pctBuy){buyPct=parseInt(pctBuy[1]);}
            // عند أول سعر نوقف البحث
            if(!priceLine) priceLine=lines[j].match(/Price:([\d.]+)→([\d.]+)/);
            j++;
          }

          const vol=parseFloat(volMatch[1]);
          const symbolMatch=l.match(/^┌?#?(\w+)/); // استخراج الرمز إن وُجد
          const symbol=symbolMatch?symbolMatch[1]:"UNKN";

          if(priceLine){
            const p1=parseFloat(priceLine[1]);
            const p2=parseFloat(priceLine[2]);
            records.push({symbol,vol,sellPct,buyPct,p1,p2,rawLine:l.trim()});
          }
        }
        i++;
      }

      // ترتيب حسب أكبر حجم (أو يمكنك حسب أعلى نسبة بيع)
      records.sort((a,b)=>b.vol-a.vol);

      let html="";
      records.forEach(rec=>{
        const {symbol,vol,sellPct,buyPct,p1,p2,rawLine}=rec;
        const change=Math.abs(p2-p1);
        // استراتيجية البيع القوي
        if(sellPct!==null && sellPct<=-95 && change<0.001){
          html+=`<div class="block"><span class="sig-sell">🔴 بيع قوي – ${symbol}</span><br>
                 حجم: ${vol}Ƀ | Sell: ${sellPct}% | سعر: ${p1}→${p2}<br>
                 <small>${rawLine}</small></div>`;
        }
        // استراتيجية الشراء الذكي (بيع كبير لكن السعر لم يهبط كثيرًا)
        if(sellPct!==null && sellPct<=-80 && change<0.005){
          html+=`<div class="block"><span class="sig-buy">🟢 شراء ذكي – ${symbol}</span><br>
                 حجم: ${vol}Ƀ | Sell: ${sellPct}% | سعر: ${p1}→${p2}<br>
                 <small>${rawLine}</small></div>`;
        }
        // حالة نادرة: شراء 100%
        if(buyPct!==null && buyPct===100){
          html+=`<div class="block"><span class="sig-buy">✅ شراء 100% – ${symbol}</span><br>
                 حجم: ${vol}Ƀ | Buy: ${buyPct}% | سعر: ${p1}→${p2}<br>
                 <small>${rawLine}</small></div>`;
        }
      });

      document.getElementById("result").innerHTML= html || "لا توجد إشارات مطابقة للاستراتيجية";
    }
  </script>

</body>
</html>
