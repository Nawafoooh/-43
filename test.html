<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø§ÙØ³ - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .title-section h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #e67e22;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .school-info {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
            color: #666;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .icon.questions { background: linear-gradient(135deg, #3498db, #2980b9); }
        .icon.students { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .icon.reports { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .icon.settings { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .icon.disq { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .icon.messages { background: linear-gradient(135deg, #16a085, #1abc9c); }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn.info {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.green {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .stat-card.red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #ecf0f1;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .loading.show {
            display: block;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .notification.success { background: linear-gradient(135deg, #4CAF50, #45a049); }
        .notification.error { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .notification.info { background: linear-gradient(135deg, #3498db, #2980b9); }

        /* Messages Styles */
        .message-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .message-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .message-item.unread {
            background: #fff3cd;
            border-right-color: #f39c12;
        }

        .message-item.replied {
            background: #d4edda;
            border-right-color: #28a745;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .message-info {
            flex: 1;
        }

        .message-info h4 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .message-info p {
            color: #7f8c8d;
            font-size: 14px;
            margin: 3px 0;
        }

        .message-content {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            line-height: 1.8;
            color: #2c3e50;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .message-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .message-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .message-badge.new {
            background: #fff3cd;
            color: #856404;
        }

        .message-badge.read {
            background: #d1ecf1;
            color: #0c5460;
        }

        .message-badge.replied {
            background: #d4edda;
            color: #155724;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .tab {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">Ù†</div>
                <div class="title-section">
                    <h1>Ù†Ø§ÙØ³</h1>
                    <div class="subtitle">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</div>
                </div>
            </div>
            <div class="school-info">
                <strong>ğŸ« Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© ÙˆØ§Ù„Ø£Ø±Ø¨Ø¹ÙˆÙ†</strong><br>
                ğŸ“ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© - Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©<br>
                ğŸ‘©â€ğŸ’¼ <strong>Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø±ÙŠÙ… Ø§Ù„Ø¹Ù†Ø²ÙŠ</strong>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('messages')">ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
            <button class="tab" onclick="switchTab('questions')">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
            <button class="tab" onclick="switchTab('students')">ğŸ‘¥ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</button>
            <button class="tab" onclick="switchTab('disqualified')">ğŸš« Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø§Øª</button>
            <button class="tab" onclick="switchTab('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="tab" onclick="switchTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Messages Tab -->
        <div id="messagesTab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-number" id="unreadMessages">0</div>
                    <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-number" id="readMessages">0</div>
                    <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-number" id="repliedMessages">0</div>
                    <div class="stat-label">ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="icon messages">ğŸ’¬</div>
                    <span>Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</span>
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterMessages('all')">Ø§Ù„ÙƒÙ„</button>
                    <button class="filter-btn" onclick="filterMessages('unread')">ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</button>
                    <button class="filter-btn" onclick="filterMessages('read')">Ù…Ù‚Ø±ÙˆØ¡Ø©</button>
                    <button class="filter-btn" onclick="filterMessages('replied')">ØªÙ… Ø§Ù„Ø±Ø¯</button>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="btn success" onclick="loadMessages()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
                    <button class="btn warning" onclick="markAllAsRead()">âœ… ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
                </div>

                <div id="messagesLoading" class="loading">
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</p>
                </div>

                <div id="messagesList"></div>
            </div>
        </div>

        <!-- Questions Tab -->
        <div id="questionsTab" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <div class="icon questions">ğŸ“</div>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span>
                </div>
                <p style="text-align:center;padding:40px;color:#7f8c8d">
                    ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...
                </p>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="studentsTab" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <div class="icon students">ğŸ‘¥</div>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</span>
                </div>
                <p style="text-align:center;padding:40px;color:#7f8c8d">
                    ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª...
                </p>
            </div>
        </div>

        <!-- Disqualified Tab -->
        <div id="disqualifiedTab" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <div class="icon disq">ğŸš«</div>
                    <span>Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø§Øª</span>
                </div>
                <p style="text-align:center;padding:40px;color:#7f8c8d">
                    ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ¨Ø¹Ø¯Ø§Øª...
                </p>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <div class="icon reports">ğŸ“Š</div>
                    <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                </div>
                <p style="text-align:center;padding:40px;color:#7f8c8d">
                    ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...
                </p>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <div class="icon settings">âš™ï¸</div>
                    <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                </div>
                <p style="text-align:center;padding:40px;color:#7f8c8d">
                    ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; margin-top: 40px; color: white; font-size: 14px;">
            <p>Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø±ÙŠÙ… Ø§Ù„Ø¹Ù†Ø²ÙŠ</p>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, getDocs, updateDoc, deleteDoc, doc, writeBatch } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDX-CG9L4XaVPtqgexD0Da0owXEa0-I3YM",
            authDomain: "nafis-girls-school.firebaseapp.com",
            projectId: "nafis-girls-school",
            storageBucket: "nafis-girls-school.firebasestorage.app",
            messagingSenderId: "998478495565",
            appId: "1:998478495565:web:67bb560b773ea1956ac104",
            measurementId: "G-TPKDV51KNN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global Variables
        let allMessages = [];
        let currentMessageFilter = 'all';

        // Notification System
        window.showNotification = function(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        };

        // Loading Indicator
        window.showLoading = function(elementId, show) {
            const element = document.getElementById(elementId);
            if (element) {
                if (show) {
                    element.classList.add('show');
                } else {
                    element.classList.remove('show');
                }
            }
        };

        // Tab Switching
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            if (tabName === 'messages') loadMessages();
        };

        // Messages Management
        window.loadMessages = async function() {
            showLoading('messagesLoading', true);
            try {
                const snap = await getDocs(collection(db, 'messages'));
                allMessages = [];
                snap.forEach(d => allMessages.push({ id: d.id, ...d.data() }));
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
                allMessages.sort((a, b) => {
                    const timeA = a.timestamp?.toDate() || new Date(0);
                    const timeB = b.timestamp?.toDate() || new Date(0);
                    return timeB - timeA;
                });
                
                updateMessagesStats();
                displayMessages();
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (e) {
                console.error(e);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'error');
            } finally {
                showLoading('messagesLoading', false);
            }
        };

        function updateMessagesStats() {
            const stats = {
                total: allMessages.length,
                unread: allMessages.filter(m => !m.read).length,
                read: allMessages.filter(m => m.read && !m.replied).length,
                replied: allMessages.filter(m => m.replied).length
            };
            
            document.getElementById('totalMessages').textContent = stats.total;
            document.getElementById('unreadMessages').textContent = stats.unread;
            document.getElementById('readMessages').textContent = stats.read;
            document.getElementById('repliedMessages').textContent = stats.replied;
        }

        function displayMessages() {
            let filtered = allMessages;
            
            if (currentMessageFilter === 'unread') {
                filtered = allMessages.filter(m => !m.read);
            } else if (currentMessageFilter === 'read') {
                filtered = allMessages.filter(m => m.read && !m.replied);
            } else if (currentMessageFilter === 'replied') {
                filtered = allMessages.filter(m => m.replied);
            }
            
            const box = document.getElementById('messagesList');
            
            if (!filtered.length) {
                box.innerHTML = `
                    <div style="text-align:center;padding:40px;color:#7f8c8d">
                        <p style="font-size:18px">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</p>
                    </div>`;
                return;
            }
            
            box.innerHTML = filtered.map(msg => {
                const messageClass = msg.replied ? 'replied' : !msg.read ? 'unread' : '';
                const badge = msg.replied ? '<span class="message-badge replied">âœ… ØªÙ… Ø§Ù„Ø±Ø¯</span>' : 
                             !msg.read ? '<span class="message-badge new">ğŸ”” Ø¬Ø¯ÙŠØ¯Ø©</span>' : 
                             '<span class="message-badge read">ğŸ‘ï¸ Ù…Ù‚Ø±ÙˆØ¡Ø©</span>';
                
                const timestamp = msg.timestamp?.toDate() || new Date();
                const dateStr = timestamp.toLocaleString('ar-SA');
                
                return `
                <div class="message-item ${messageClass}">
                    <div class="message-header">
                        <div class="message-info">
                            <h4>${msg.studentName} ${badge}</h4>
                            <p>Ø§Ù„ØµÙ ${msg.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${msg.class} â€¢ ${msg.studentCode}</p>
                            <p style="color:#999;font-size:12px;">ğŸ“… ${dateStr} â€¢ ğŸ“ ${msg.wordCount || 0} ÙƒÙ„Ù…Ø©</p>
                        </div>
                    </div>
                    <div class="message-content">${msg.message}</div>
                    <div class="message-actions">
                        ${!msg.read ? `<button class="btn info" onclick="markAsRead('${msg.id}')">âœ… ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>` : ''}
                        ${msg.read && !msg.replied ? `<button class="btn success" onclick="markAsReplied('${msg.id}')">ğŸ’¬ ØªØ¹Ù„ÙŠÙ… ÙƒØªÙ… Ø§Ù„Ø±Ø¯</button>` : ''}
                        <button class="btn danger" onclick="deleteMessage('${msg.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                </div>`;
            }).join('');
        }

        window.filterMessages = function(filter) {
            currentMessageFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayMessages();
        };

        window.markAsRead = async function(id) {
            try {
                await updateDoc(doc(db, 'messages', id), { read: true });
                showNotification('âœ… ØªÙ… ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©', 'success');
                loadMessages();
            } catch (e) {
                console.error(e);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            }
        };

        window.markAsReplied = async function(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† ØªØ¹Ù„ÙŠÙ… Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ€ "ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§"ØŸ')) return;
            try {
                await updateDoc(doc(db, 'messages', id), { 
                    replied: true, 
                    repliedAt: new Date() 
                });
                showNotification('âœ… ØªÙ… ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
                loadMessages();
            } catch (e) {
                console.error(e);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            }
        };

        window.deleteMessage = async function(id) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) return;
            try {
                await deleteDoc(doc(db, 'messages', id));
                showNotification('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
                loadMessages();
            } catch (e) {
                console.error(e);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
            }
        };

        window.markAllAsRead = async function() {
            const unread = allMessages.filter(m => !m.read);
            if (!unread.length) {
                showNotification('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù‚Ø±ÙˆØ¡Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'info');
                return;
            }
            
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† ØªØ¹Ù„ÙŠÙ… ${unread.length} Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©ØŸ`)) return;
            
            try {
                const batch = writeBatch(db);
                unread.forEach(m => {
                    batch.update(doc(db, 'messages', m.id), { read: true });
                });
                await batch.commit();
                showNotification(`âœ… ØªÙ… ØªØ¹Ù„ÙŠÙ… ${unread.length} Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©`, 'success');
                loadMessages();
            } catch (e) {
                console.error(e);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadMessages();
            console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø§Ù‡Ø²');
        });

    </script>
</body>
</html>
