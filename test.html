<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø¬Ù„Ø³Ø§Øª Nawaf Wyckoff</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .booking-card {
            transition: all 0.3s ease;
        }
        
        .booking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .time-slot {
            transition: all 0.2s ease;
        }
        
        .time-slot:hover:not(.booked) {
            transform: scale(1.05);
        }
        
        .time-slot.booked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, 0); }
        }
        
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full"></div>
  <script>
        const defaultConfig = {
            platform_title: "Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø¬Ù„Ø³Ø§Øª Nawaf Wyckoff",
            trainer_name: "Nawaf Wyckoff",
            session_duration: "75 Ø¯Ù‚ÙŠÙ‚Ø© + 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø±Ø§Ø­Ø©",
            booking_button: "Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†",
            admin_title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨",
            background_color: "#f8fafc",
            surface_color: "#ffffff",
            text_color: "#1e293b",
            primary_action_color: "#3b82f6",
            secondary_action_color: "#64748b",
            font_family: "Cairo",
            font_size: 16
        };

        let currentBookings = [];
        let currentView = 'student';
        let selectedDay = null;
        let isLoading = false;

        const DAYS = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'];
        const TIME_SLOTS = [
            { time: '4:00 PM', label: '4:00 Ø¹ØµØ±Ø§Ù‹' },
            { time: '5:30 PM', label: '5:30 Ù…Ø³Ø§Ø¡Ù‹' },
            { time: '7:00 PM', label: '7:00 Ù…Ø³Ø§Ø¡Ù‹' },
            { time: '8:30 PM', label: '8:30 Ù…Ø³Ø§Ø¡Ù‹' }
        ];

        const ADMIN_PASSWORD = 'wyckoff2024';

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function isSlotBooked(day, time) {
            return currentBookings.some(booking => 
                booking.day === day && booking.time === time && booking.status === 'active'
            );
        }

        function getStudentBookingCount(studentName) {
            return currentBookings.filter(booking => 
                booking.studentName === studentName && booking.status === 'active'
            ).length;
        }

        async function handleBooking(day, time) {
            if (isSlotBooked(day, time)) {
                showToast('Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ø®ØµØµØ© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±
            const config = window.elementSdk?.config || defaultConfig;
            const nameInputDiv = document.createElement('div');
            nameInputDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            nameInputDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4 w-full">
                    <h3 class="text-xl font-bold mb-4 text-center" style="color: ${config.text_color}">
                        ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±
                    </h3>
                    <p class="mb-4 text-center" style="color: ${config.text_color}; opacity: 0.8;">
                        Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                    </p>
                    <input type="text" id="studentNameInput" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±..." 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 text-right"
                           style="font-family: Cairo, sans-serif; direction: rtl;">
                    <div class="flex gap-3">
                        <button id="confirmName" class="flex-1 px-4 py-2 rounded-lg text-white font-semibold" 
                                style="background-color: ${config.primary_action_color}">
                            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
                        </button>
                        <button id="cancelName" class="flex-1 px-4 py-2 rounded-lg font-semibold" 
                                style="background-color: ${config.secondary_action_color}; color: white;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(nameInputDiv);
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                const nameInput = document.getElementById('studentNameInput');
                if (nameInput) {
                    nameInput.focus();
                }
            }, 100);

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
            document.getElementById('studentNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('confirmName').click();
                }
            });

            document.getElementById('confirmName').onclick = async () => {
                const studentName = document.getElementById('studentNameInput').value.trim();
                if (!studentName) {
                    showToast('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±', 'error');
                    document.getElementById('studentNameInput').focus();
                    return;
                }
                
                nameInputDiv.remove();
                await processBooking(day, time, studentName);
            };

            document.getElementById('cancelName').onclick = () => {
                nameInputDiv.remove();
            };
        }

        async function processBooking(day, time, studentName) {
            // ÙØ­Øµ Ø­Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ (3 Ø£ÙŠØ§Ù… ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
            if (getStudentBookingCount(studentName) >= 3) {
                showToast('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø¬Ø² Ù„Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£ÙŠØ§Ù…', 'error');
                return;
            }

            if (currentBookings.length >= 999) {
                showToast('Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª', 'error');
                return;
            }

            isLoading = true;
            renderApp();

            const newBooking = {
                id: Date.now().toString(),
                day: day,
                time: time,
                studentName: studentName,
                createdAt: new Date().toISOString(),
                status: 'active'
            };

            const result = await window.dataSdk.create(newBooking);
            
            isLoading = false;

            if (result.isOk) {
                showToast('ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­! âœ“');
                selectedDay = null;
            } else {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
            }
            
            renderApp();
        }

        async function handleCancelBooking(bookingId) {
            const booking = currentBookings.find(b => b.__backendId === bookingId);
            if (!booking) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-xl font-bold mb-4" style="color: ${window.elementSdk.config.text_color || defaultConfig.text_color}">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</h3>
                    <p class="mb-6" style="color: ${window.elementSdk.config.text_color || defaultConfig.text_color}">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø² ${booking.studentName}ØŸ</p>
                    <div class="flex gap-3">
                        <button id="confirmCancel" class="flex-1 px-4 py-2 rounded-lg text-white font-semibold" style="background-color: ${window.elementSdk.config.primary_action_color || defaultConfig.primary_action_color}">
                            Ù†Ø¹Ù…ØŒ Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button id="cancelCancel" class="flex-1 px-4 py-2 rounded-lg font-semibold" style="background-color: ${window.elementSdk.config.secondary_action_color || defaultConfig.secondary_action_color}; color: white;">
                            ØªØ±Ø§Ø¬Ø¹
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);

            document.getElementById('confirmCancel').onclick = async () => {
                confirmDiv.remove();
                isLoading = true;
                renderApp();

                const result = await window.dataSdk.delete(booking);
                
                isLoading = false;

                if (result.isOk) {
                    showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù„ØºØ§Ø¡', 'error');
                }
                
                renderApp();
            };

            document.getElementById('cancelCancel').onclick = () => {
                confirmDiv.remove();
            };
        }

        function handleAdminLogin() {
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if (password === ADMIN_PASSWORD) {
                currentView = 'admin';
                renderApp();
            } else if (password !== null) {
                showToast('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©', 'error');
            }
        }

        function renderStudentView() {
            const config = window.elementSdk?.config || defaultConfig;
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontSize = config.font_size || defaultConfig.font_size;
            const fontStack = `${customFont}, Cairo, sans-serif`;

            return `
                <div class="min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                    <div class="max-w-6xl mx-auto">
                        <!-- Header -->
                        <div class="text-center mb-8 fade-in">
                            <h1 class="font-bold mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 2}px;">
                                ${config.platform_title || defaultConfig.platform_title}
                            </h1>
                            <p class="mb-4" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize}px; opacity: 0.8;">
                                Ø§Ø­Ø¬Ø² Ø¬Ù„Ø³ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø¹ ${config.trainer_name || defaultConfig.trainer_name}
                            </p>
                            <div class="inline-block px-4 py-2 rounded-full" style="background-color: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; font-size: ${baseFontSize * 0.85}px;">
                                Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©: ${config.session_duration || defaultConfig.session_duration}
                            </div>
                        </div>

                        <!-- Admin Button -->
                        <div class="text-center mb-6">
                            <button onclick="handleAdminLogin()" class="px-4 py-2 rounded-lg text-white font-semibold transition-all hover:opacity-90" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; font-size: ${baseFontSize * 0.9}px;">
                                Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¨
                            </button>
                        </div>

                        ${!selectedDay ? `
                            <!-- Days Selection -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                                ${DAYS.map(day => `
                                    <div class="booking-card p-6 rounded-xl cursor-pointer" 
                                         style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                                         onclick="selectedDay = '${day}'; renderApp();">
                                        <div class="text-center">
                                            <div class="text-4xl mb-3">ğŸ“…</div>
                                            <h3 class="font-bold mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 1.25}px;">
                                                ${day}
                                            </h3>
                                            <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 0.85}px; opacity: 0.7;">
                                                ${TIME_SLOTS.filter(slot => !isSlotBooked(day, slot.time)).length} Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­
                                            </p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <!-- Time Slots -->
                            <div class="fade-in">
                                <button onclick="selectedDay = null; renderApp();" 
                                        class="mb-6 px-4 py-2 rounded-lg font-semibold transition-all hover:opacity-90"
                                        style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; font-size: ${baseFontSize * 0.9}px;">
                                    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ÙŠØ§Ù…
                                </button>
                                
                                <h2 class="font-bold mb-6 text-center" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 1.5}px;">
                                    Ø§Ø®ØªØ± Ù…ÙˆØ¹Ø¯Ùƒ - ${selectedDay}
                                </h2>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${TIME_SLOTS.map(slot => {
                                        const booked = isSlotBooked(selectedDay, slot.time);
                                        return `
                                            <div class="time-slot p-6 rounded-xl ${booked ? 'booked' : 'cursor-pointer'}"
                                                 style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                                                 ${!booked ? `onclick="handleBooking('${selectedDay}', '${slot.time}')"` : ''}>
                                                <div class="text-center">
                                                    <div class="text-3xl mb-3">${booked ? 'ğŸ”’' : 'â°'}</div>
                                                    <h3 class="font-bold mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 1.1}px;">
                                                        ${slot.label}
                                                    </h3>
                                                    <p style="color: ${booked ? '#ef4444' : config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${baseFontSize * 0.85}px; font-weight: 600;">
                                                        ${booked ? 'Ù…Ø­Ø¬ÙˆØ²' : config.booking_button || defaultConfig.booking_button}
                                                    </p>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAdminView() {
            const config = window.elementSdk?.config || defaultConfig;
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontSize = config.font_size || defaultConfig.font_size;
            const fontStack = `${customFont}, Cairo, sans-serif`;

            const bookingsByDay = {};
            DAYS.forEach(day => {
                bookingsByDay[day] = currentBookings.filter(b => b.day === day && b.status === 'active');
            });

            return `
                <div class="min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                    <div class="max-w-6xl mx-auto">
                        <!-- Header -->
                        <div class="flex justify-between items-center mb-8 fade-in">
                            <h1 class="font-bold" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 2}px;">
                                ${config.admin_title || defaultConfig.admin_title}
                            </h1>
                            <button onclick="currentView = 'student'; renderApp();" 
                                    class="px-4 py-2 rounded-lg text-white font-semibold transition-all hover:opacity-90"
                                    style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; font-size: ${baseFontSize * 0.9}px;">
                                Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØµØ©
                            </button>
                        </div>

                        <!-- Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div class="p-6 rounded-xl" style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div class="text-3xl mb-2">ğŸ“Š</div>
                                <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 0.85}px; opacity: 0.7;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p>
                                <p class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${baseFontSize * 1.5}px;">
                                    ${currentBookings.filter(b => b.status === 'active').length}
                                </p>
                            </div>
                            <div class="p-6 rounded-xl" style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div class="text-3xl mb-2">âœ…</div>
                                <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 0.85}px; opacity: 0.7;">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</p>
                                <p class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${baseFontSize * 1.5}px;">
                                    ${currentBookings.filter(b => b.status === 'active').length}
                                </p>
                            </div>
                            <div class="p-6 rounded-xl" style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div class="text-3xl mb-2">ğŸ“…</div>
                                <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 0.85}px; opacity: 0.7;">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                                <p class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${baseFontSize * 1.5}px;">
                                    ${(DAYS.length * TIME_SLOTS.length) - currentBookings.filter(b => b.status === 'active').length}
                                </p>
                            </div>
                        </div>

                        <!-- Bookings by Day -->
                        ${DAYS.map(day => {
                            const dayBookings = bookingsByDay[day];
                            if (dayBookings.length === 0) return '';
                            
                            return `
                                <div class="mb-6 fade-in">
                                    <h2 class="font-bold mb-4" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 1.25}px;">
                                        ${day} (${dayBookings.length} Ø­Ø¬Ø²)
                                    </h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        ${dayBookings.map(booking => `
                                            <div class="p-4 rounded-lg" style="background-color: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <p class="font-bold mb-1" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize}px;">
                                                            ${booking.studentName}
                                                        </p>
                                                        <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 0.85}px; opacity: 0.7;">
                                                            ${TIME_SLOTS.find(s => s.time === booking.time)?.label || booking.time}
                                                        </p>
                                                    </div>
                                                    <span class="text-2xl">ğŸ‘¤</span>
                                                </div>
                                                <button onclick="handleCancelBooking('${booking.__backendId}')" 
                                                        class="w-full px-3 py-2 rounded-lg text-white font-semibold transition-all hover:opacity-90"
                                                        style="background-color: #ef4444; font-size: ${baseFontSize * 0.85}px;">
                                                    Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}

                        ${currentBookings.filter(b => b.status === 'active').length === 0 ? `
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">ğŸ“­</div>
                                <p class="font-bold" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseFontSize * 1.25}px;">
                                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹
                                </p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderApp() {
            const app = document.getElementById('app');
            const html = currentView === 'student' ? renderStudentView() : renderAdminView();
            app.innerHTML = html;

            if (isLoading) {
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50';
                loadingOverlay.innerHTML = `
                    <div class="bg-white rounded-lg p-6 flex items-center gap-3">
                        <div class="loading-spinner" style="border-top-color: ${window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color}"></div>
                        <span class="font-semibold" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</span>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);
            }
        }

        const dataHandler = {
            onDataChanged(data) {
                currentBookings = data;
                renderApp();
            }
        };

        async function onConfigChange(config) {
            renderApp();
        }

        async function init() {
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return;
            }

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.background_color || defaultConfig.background_color,
                                set: (value) => {
                                    config.background_color = value;
                                    window.elementSdk.setConfig({ background_color: value });
                                }
                            },
                            {
                                get: () => config.surface_color || defaultConfig.surface_color,
                                set: (value) => {
                                    config.surface_color = value;
                                    window.elementSdk.setConfig({ surface_color: value });
                                }
                            },
                            {
                                get: () => config.text_color || defaultConfig.text_color,
                                set: (value) => {
                                    config.text_color = value;
                                    window.elementSdk.setConfig({ text_color: value });
                                }
                            },
                            {
                                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                                set: (value) => {
                                    config.primary_action_color = value;
                                    window.elementSdk.setConfig({ primary_action_color: value });
                                }
                            },
                            {
                                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                                set: (value) => {
                                    config.secondary_action_color = value;
                                    window.elementSdk.setConfig({ secondary_action_color: value });
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || defaultConfig.font_family,
                            set: (value) => {
                                config.font_family = value;
                                window.elementSdk.setConfig({ font_family: value });
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || defaultConfig.font_size,
                            set: (value) => {
                                config.font_size = value;
                                window.elementSdk.setConfig({ font_size: value });
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["platform_title", config.platform_title || defaultConfig.platform_title],
                        ["trainer_name", config.trainer_name || defaultConfig.trainer_name],
                        ["session_duration", config.session_duration || defaultConfig.session_duration],
                        ["booking_button", config.booking_button || defaultConfig.booking_button],
                        ["admin_title", config.admin_title || defaultConfig.admin_title]
                    ])
                });
            }

            renderApp();
        }

        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99b5cc0d33ed2cfc',t:'MTc2MjYxMjUyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
