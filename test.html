<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø­Ø¬Ø² Ù„Ù‚Ø§Ø¡  </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap' );
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .booking-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .booking-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .time-slot {
            transition: all 0.2s ease;
        }
        .time-slot:hover:not(.booked) {
            transform: scale(1.05);
            border-color: #3b82f6;
        }
        .time-slot.booked {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #f1f5f9;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideDown 0.3s ease-out, fadeOut 0.3s ease-in 2.7s forwards;
        }
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, 0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        .modal-overlay {
            animation: fadeIn 0.2s ease;
        }
        .modal-content {
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar {
            background-color: #e5e7eb;
            border-radius: 99px;
            overflow: hidden;
            height: 8px;
        }
        .progress-bar-inner {
            height: 100%;
            background-color: #3b82f6;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="app" class="min-h-screen"></div>

    <script>
        // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
        const config = {
            platform_title: "Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©",
            subtitle: "Ø®Ø¨ÙŠØ± ÙˆØ§ÙŠÙƒÙˆÙ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…ÙŠ",
            motivational_quote: "Ù„Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø¥ØªÙ‚Ø§Ù† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³ÙˆÙ‚.",
            booking_button_text: "Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†",
            admin_title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø¨",
            primary_color: "#3b82f6",
            secondary_color: "#64748b",
        };

        const DAYS = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'];
        const TIME_SLOTS = [
            { time: '16:00', label: '4:00 Ø¹ØµØ±Ø§Ù‹' },
            { time: '17:15', label: '5:15 Ù…Ø³Ø§Ø¡Ù‹' },
            { time: '18:30', label: '6:30 Ù…Ø³Ø§Ø¡Ù‹' },
            { time: '19:45', label: '7:45 Ù…Ø³Ø§Ø¡Ù‹' },
            { time: '21:00', label: '9:00 Ù…Ø³Ø§Ø¡Ù‹' }
        ];
        const SESSION_DURATION_MINUTES = 75;
        const ADMIN_PASSWORD = 'wyckoff2024';

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† ---
        let state = {
            bookings: [],
            currentView: 'student',
            selectedDay: null,
        };

        const db = {
            load: () => JSON.parse(localStorage.getItem('wyckoffBookings_v2') || '[]'),
            save: (data) => localStorage.setItem('wyckoffBookings_v2', JSON.stringify(data)),
        };

        // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function isSlotBooked(day, time) {
            return state.bookings.some(b => b.day === day && b.time === time);
        }
        
        function generateICS(booking) {
            const slot = TIME_SLOTS.find(s => s.time === booking.time);
            const dayIndex = DAYS.indexOf(booking.day);
            
            // Calculate the correct date for the upcoming weekday
            const now = new Date();
            const currentDay = now.getDay(); // Sunday = 0, Monday = 1...
            const targetDay = (dayIndex + 0) % 7; // Assuming Ø§Ù„Ø£Ø­Ø¯ is 0
            let dayDifference = targetDay - currentDay;
            if (dayDifference < 0) {
                dayDifference += 7;
            }
            const eventDate = new Date(now.setDate(now.getDate() + dayDifference));
            
            const [hours, minutes] = slot.time.split(':');
            eventDate.setHours(hours, minutes, 0, 0);

            const toUTC = (date) => new Date(date.getTime() - (date.getTimezoneOffset() * 60000)).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

            const startDate = eventDate;
            const endDate = new Date(startDate.getTime() + SESSION_DURATION_MINUTES * 60000);

            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//NawafWyckoff//BookingPlatform//EN',
                'BEGIN:VEVENT',
                `UID:${booking.id}@wyckoffnawaf.com`,
                `DTSTAMP:${toUTC(new Date())}`,
                `DTSTART:${toUTC(startDate)}`,
                `DTEND:${toUTC(endDate)}`,
                'SUMMARY:Ø¬Ù„Ø³Ø© ØªØ­Ù„ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø¨ Ù†ÙˆØ§Ù ÙˆØ§ÙŠÙƒÙˆÙ',
                `DESCRIPTION:Ø¬Ù„Ø³Ø© ÙØ±Ø¯ÙŠØ© Ù…Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ ${booking.studentName}.`,
                'LOCATION:Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'booking.ics';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ---
        function handleBooking(day, time) {
            if (isSlotBooked(day, time)) return;

            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="modal-content bg-white rounded-xl p-6 max-w-sm w-full">
                    <h3 class="text-xl font-bold mb-2 text-center">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</h3>
                    <p class="mb-4 text-center text-slate-600">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>
                    <input type="text" id="studentNameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." 
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg mb-4 text-right focus:border-blue-500 focus:ring-0 outline-none">
                    <div class="flex gap-3">
                        <button id="confirmName" class="flex-1 px-4 py-3 rounded-lg text-white font-semibold transition" style="background-color: ${config.primary_color};">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
                        <button id="cancelName" class="flex-1 px-4 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 transition">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('studentNameInput').focus();

            modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
            document.getElementById('cancelName').onclick = () => modal.remove();
            document.getElementById('confirmName').onclick = () => {
                const studentName = document.getElementById('studentNameInput').value.trim();
                if (!studentName) {
                    showToast('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø±', 'error');
                    return;
                }
                modal.remove();
                processBooking(day, time, studentName);
            };
        }

        function processBooking(day, time, studentName) {
            const newBooking = { id: Date.now().toString(), day, time, studentName };
            state.bookings.push(newBooking);
            db.save(state.bookings);
            state.selectedDay = null;
            render(); // Re-render to show the main page
            showConfirmation(newBooking); // Show the new confirmation modal
        }
        
        function showConfirmation(booking) {
            const slot = TIME_SLOTS.find(s => s.time === booking.time);
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="modal-content bg-white rounded-xl p-6 max-w-sm w-full text-center">
                    <div class="mx-auto bg-green-100 rounded-full h-16 w-16 flex items-center justify-center mb-4">
                        <svg class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    </div>
                    <h3 class="text-xl font-bold mb-2">ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h3>
                    <p class="mb-4 text-slate-600">
                        Ø±Ø§Ø¦Ø¹ ÙŠØ§ ${booking.studentName}! Ø¬Ù„Ø³ØªÙƒ Ù…Ø¤ÙƒØ¯Ø© ÙŠÙˆÙ… <strong>${booking.day}</strong> Ø§Ù„Ø³Ø§Ø¹Ø© <strong>${slot.label}</strong>.
                    </p>
                    <button id="addToCalendar" class="w-full mb-2 px-4 py-3 rounded-lg text-white font-semibold transition" style="background-color: ${config.primary_color};">
                        ğŸ“… Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
                    </button>
                    <button id="closeConfirm" class="w-full px-4 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 transition">Ø­Ø³Ù†Ø§Ù‹</button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('closeConfirm').onclick = () => modal.remove();
            document.getElementById('addToCalendar').onclick = () => generateICS(booking);
        }

        function handleCancelBooking(bookingId) {
            state.bookings = state.bookings.filter(b => b.id !== bookingId);
            db.save(state.bookings);
            showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
            render();
        }

        function handleAdminLogin() {
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯Ø±Ø¨:');
            if (password === ADMIN_PASSWORD) {
                state.currentView = 'admin';
                render();
            } else if (password) {
                showToast('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©', 'error');
            }
        }

        // --- Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
        function renderStudentView() {
            const bookedSlotsCount = (day) => state.bookings.filter(b => b.day === day).length;
            const totalSlots = TIME_SLOTS.length;

            return `
                <div class="min-h-screen p-4 sm:p-8">
                    <div class="max-w-7xl mx-auto">
                        <header class="text-center mb-10 fade-in">
                            <h2 class="text-2xl font-bold text-slate-500">${config.subtitle}</h2>
                            <h1 class="text-4xl sm:text-5xl font-bold my-2 text-slate-900">${config.platform_title}</h1>
                            <p class="text-lg text-slate-600">${config.motivational_quote}</p>
                        </header>

                        <div class="text-center mb-10">
                            <button onclick="handleAdminLogin()" class="px-5 py-2 rounded-full text-sm text-white font-semibold transition hover:opacity-90" style="background-color: ${config.secondary_color};">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¨</button>
                        </div>

                        ${!state.selectedDay ? `
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5">
                                ${DAYS.map(day => {
                                    const bookedCount = bookedSlotsCount(day);
                                    const occupancy = (bookedCount / totalSlots) * 100;
                                    return `
                                    <div class="booking-card bg-white p-5 rounded-xl cursor-pointer" onclick="state.selectedDay = '${day}'; render();">
                                        <div class="text-center">
                                            <h3 class="text-2xl font-bold text-slate-800 mb-3">${day}</h3>
                                            <div class="progress-bar mb-2"><div class="progress-bar-inner" style="width: ${occupancy}%;"></div></div>
                                            <p class="text-sm text-slate-500">${totalSlots - bookedCount} Ù…ÙˆØ¹Ø¯ Ù…ØªØ¨Ù‚ÙŠ</p>
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        ` : `
                            <div class="fade-in">
                                <button onclick="state.selectedDay = null; render();" class="mb-6 px-4 py-2 rounded-lg font-semibold text-white transition hover:opacity-90 flex items-center gap-2" style="background-color: ${config.secondary_color};">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 12h14"></path></svg>
                                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ÙŠØ§Ù…
                                </button>
                                <h2 class="text-3xl font-bold mb-6 text-center">Ø§Ø®ØªØ± Ù…ÙˆØ¹Ø¯Ùƒ Ù„ÙŠÙˆÙ… ${state.selectedDay}</h2>
                                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                    ${TIME_SLOTS.map(slot => {
                                        const booked = isSlotBooked(state.selectedDay, slot.time);
                                        return `
                                            <div class="time-slot bg-white p-4 rounded-xl border-2 border-transparent ${booked ? 'booked' : 'cursor-pointer'}" ${!booked ? `onclick="handleBooking('${state.selectedDay}', '${slot.time}')"` : ''}>
                                                <div class="text-center">
                                                    <h3 class="font-bold text-lg">${slot.label}</h3>
                                                    <p class="font-semibold text-sm" style="color: ${booked ? '#ef4444' : config.primary_color};">${booked ? 'Ù…Ø­Ø¬ÙˆØ²' : config.booking_button_text}</p>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAdminView() {
            // Admin view remains unchanged as requested
            const totalSlots = DAYS.length * TIME_SLOTS.length;
            const bookedSlots = state.bookings.length;
            const bookingsByDay = DAYS.map(day => ({
                day,
                bookings: state.bookings.filter(b => b.day === day).sort((a, b) => a.time.localeCompare(b.time))
            })).filter(d => d.bookings.length > 0);

            return `
                <div class="min-h-screen p-4 sm:p-6">
                    <div class="max-w-6xl mx-auto">
                        <header class="flex justify-between items-center mb-8 fade-in">
                            <h1 class="text-3xl font-bold">${config.admin_title}</h1>
                            <button onclick="state.currentView = 'student'; render();" class="px-4 py-2 rounded-lg text-white font-semibold transition hover:opacity-90" style="background-color: ${config.secondary_color};">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØµØ©</button>
                        </header>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div class="bg-white p-4 rounded-xl shadow-md"><p class="text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p><p class="text-2xl font-bold" style="color: ${config.primary_color};">${bookedSlots}</p></div>
                            <div class="bg-white p-4 rounded-xl shadow-md"><p class="text-slate-500">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©</p><p class="text-2xl font-bold" style="color: ${config.primary_color};">${totalSlots - bookedSlots}</p></div>
                            <div class="bg-white p-4 rounded-xl shadow-md"><p class="text-slate-500">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</p><p class="text-2xl font-bold" style="color: ${config.primary_color};">${totalSlots > 0 ? ((bookedSlots / totalSlots) * 100).toFixed(0) : 0}%</p></div>
                        </div>
                        ${bookingsByDay.length > 0 ? bookingsByDay.map(({ day, bookings }) => `
                            <div class="mb-6 fade-in">
                                <h2 class="text-xl font-bold mb-4">${day} (${bookings.length} Ø­Ø¬ÙˆØ²Ø§Øª)</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    ${bookings.map(b => `
                                        <div class="bg-white p-4 rounded-lg shadow-md flex flex-col justify-between">
                                            <div>
                                                <p class="font-bold text-lg">${b.studentName}</p>
                                                <p class="text-slate-600 mb-3">${TIME_SLOTS.find(s => s.time === b.time)?.label}</p>
                                            </div>
                                            <button onclick="handleCancelBooking('${b.id}')" class="w-full py-2 rounded-lg text-white font-semibold bg-red-500 hover:bg-red-600">Ø¥Ù„ØºØ§Ø¡</button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('') : `
                            <div class="text-center py-16 bg-white rounded-lg shadow-md">
                                <div class="text-6xl mb-4">ğŸ“­</div>
                                <p class="font-bold text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = state.currentView === 'student' ? renderStudentView() : renderAdminView();
        }

        function init() {
            state.bookings = db.load();
            render();
        }

        init();
    </script>
</body>
</html>


