<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItin2YTZhdmG2LDYsSDYqNmGINi52YXYsdmIItin2YTYo9mG2LXYp9ix2YoiLAogICJzaG9ydF9uYW1lIjogItin2YTZhdmG2LDYsSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM0RjQ2RTUiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNakFpSUdobGFXZG9kRDBpTVRJd0lqNDhjbVZqZENCM2FXUjBhRDBpTVRJd0lpQm9aV2xuYUhROUlqRXlNQ0lnWm1sc2JEMGlJelJHTkRaRk5TSXZQanh3WVhSb0lHUTlJazB6TUNBMk1Fd3lNQ0F5TUhZeE1Hd3lNQ0F5TUdneU1IWXlNR2d5TUhZeU1Hd3lNQ0F5TUhZeU1IZ3lNSFl5TUdzd0lESXdJaUJtYVd4c1BTSWpabVptSWk4K1BDOXpkbWMrIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJzaXplcyI6ICIxMjB4MTIwIgogICAgfQogIF0KfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0iIzRGNDZFNSIvPjxwYXRoIGQ9Ik0zMCA2MEwyMCAyMHYxMGwyMCAyMGgyMHYyMGgyMHYyMGwyMCAyMGswIDIwIiBmaWxsPSIjZmZmIi8+PC9zdmc+">
    
    <title>Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { margin: 0; padding: 0; }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .badge-animation {
            animation: slideIn 0.5s ease-out, pulse 0.5s ease-out 0.5s;
        }
        
        .streak-fire {
            animation: pulse 1s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Install PWA Button (Hidden by default) -->
    <div id="install-prompt" style="display: none; position: fixed; bottom: 20px; left: 20px; right: 20px; background: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); z-index: 1000;">
        <p style="margin: 0 0 12px 0; font-weight: bold;">ğŸ“± Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬ÙˆØ§Ù„Ùƒ</p>
        <p style="margin: 0 0 12px 0; font-size: 14px; color: #666;">Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©</p>
        <div style="display: flex; gap: 8px;">
            <button id="install-btn" style="flex: 1; background: #4F46E5; color: white; padding: 10px; border: none; border-radius: 8px; font-weight: bold;">ØªØ«Ø¨ÙŠØª</button>
            <button id="dismiss-btn" style="padding: 10px 20px; background: #E5E7EB; border: none; border-radius: 8px;">Ù„Ø§Ø­Ù‚Ø§Ù‹</button>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ğŸ® Gamification System
        const BADGES = {
            FIRST_LOGIN: { name: 'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ„', icon: 'ğŸ¯', points: 5, description: 'Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚' },
            WEEK_STREAK: { name: 'Ø£Ø³Ø¨ÙˆØ¹ Ù…ØªÙˆØ§ØµÙ„', icon: 'ğŸ”¥', points: 20, description: '7 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©' },
            MONTH_STREAK: { name: 'Ø´Ù‡Ø± Ù…ØªÙˆØ§ØµÙ„', icon: 'â­', points: 50, description: '30 ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ' },
            EARLY_BIRD: { name: 'Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙƒØ±', icon: 'ğŸŒ…', points: 10, description: 'Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­Ø§Ù‹' },
            HOMEWORK_MASTER: { name: 'Ù…Ù„Ùƒ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª', icon: 'ğŸ‘‘', points: 30, description: 'Ø¥Ù†Ø¬Ø§Ø² 90% Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ù…' },
            PERFECT_MONTH: { name: 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ', icon: 'ğŸ’', points: 100, description: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ØºÙŠØ± Ù…Ù†Ø¬Ø²Ø© Ù„Ù…Ø¯Ø© Ø´Ù‡Ø±' }
        };

        // Sample student accounts
        const SAMPLE_ACCOUNTS = {
            'S-101': { name: 'Ø£Ø­Ù…Ø¯ ÙÙˆØ§Ø² Ø¨Ù† Ø³Ø¹Ø¯ÙˆÙ† Ø§Ù„Ø­Ø±Ø¨ÙŠ', verificationCode: '3971', gradeLevel: 'first', section: '1' },
            'S-102': { name: 'Ø£Ø³Ø§Ù…Ù‡ Ø³Ø¹ÙˆØ¯ Ø­Ø§Ø¬Ø± Ø§Ù„Ø­Ø±Ø¨ÙŠ', verificationCode: '1762', gradeLevel: 'first', section: '1' },
            'S-103': { name: 'Ø§Ø³Ø§Ù…Ù‡ Ù…Ø§Ø¬Ø¯ Ø¶ÙŠÙ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø²ÙˆÙŠÙƒÙŠ', verificationCode: '9542', gradeLevel: 'first', section: '1' },
            'S-201': { name: 'Ø£Ø³Ø§Ù…Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø¹ÙˆÙÙŠ', verificationCode: '9589', gradeLevel: 'first', section: '2' },
            'S-202': { name: 'Ø§Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ø¹Ù„ÙˆÙŠ Ø­Ø³ÙŠÙ† Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ', verificationCode: '9045', gradeLevel: 'first', section: '2' },
            'S-301': { name: 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø³Ù„Ø· Ø¨Ù† Ø¹Ø§ÙŠØ¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ', verificationCode: '8708', gradeLevel: 'first', section: '3' },
            'S-401': { name: 'Ø£Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± Ø¨Ù† Ø®Ù„ÙŠÙ Ø§Ù„Ø­Ø±Ø¨ÙŠ', verificationCode: '5315', gradeLevel: 'first', section: '4' },
            'S-501': { name: 'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¨Ù† ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ', verificationCode: '5899', gradeLevel: 'first', section: '5' },
            'S-601': { name: 'Ø£Ø­Ù…Ø¯ Ø¬Ù…Ø¹Ø§Ù† Ø§Ø­Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ', verificationCode: '8214', gradeLevel: 'first', section: '6' },
        };

        const HomeworkApp = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [userRole, setUserRole] = useState(null);
            const [showLogin, setShowLogin] = useState(true);
            
            const [loginStep, setLoginStep] = useState(1);
            const [loginCode, setLoginCode] = useState('');
            const [verificationCode, setVerificationCode] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [accountData, setAccountData] = useState(null);
            
            const [homeworks, setHomeworks] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [showNotifications, setShowNotifications] = useState(false);
            
            // Gamification states
            const [studentStats, setStudentStats] = useState(null);
            const [showLeaderboard, setShowLeaderboard] = useState(false);
            const [showBadges, setShowBadges] = useState(false);
            const [newBadgeEarned, setNewBadgeEarned] = useState(null);
            
            const [showCompletionModal, setShowCompletionModal] = useState(false);
            const [selectedHomework, setSelectedHomework] = useState(null);
            const [incompleteStudents, setIncompleteStudents] = useState([]);
            
            const [newHomework, setNewHomework] = useState({
                title: '',
                description: '',
                dueDate: '',
                dueTime: '',
                grade: '',
                gradeLevel: 'first',
                section: '1',
                type: 'homework'
            });

            const gradeLevels = [
                { value: 'first', label: 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·' },
                { value: 'second', label: 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·' },
                { value: 'third', label: 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·' }
            ];

            const sections = ['1', '2', '3', '4', '5', '6'];

            const homeworkTypes = [
                { value: 'homework', label: 'ÙˆØ§Ø¬Ø¨ Ù…Ù†Ø²Ù„ÙŠ' },
                { value: 'test', label: 'Ø§Ø®ØªØ¨Ø§Ø±' },
                { value: 'project', label: 'Ù…Ø´Ø±ÙˆØ¹' },
                { value: 'assignment', label: 'ØªÙƒÙ„ÙŠÙ' }
            ];

            // Load data
            useEffect(() => {
                try {
                    const savedHomeworks = localStorage.getItem('homeworks_v3');
                    const savedNotifications = localStorage.getItem('notifications_v3');
                    
                    if (savedHomeworks) setHomeworks(JSON.parse(savedHomeworks));
                    if (savedNotifications) setNotifications(JSON.parse(savedNotifications));
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            }, []);

            useEffect(() => {
                try {
                    localStorage.setItem('homeworks_v3', JSON.stringify(homeworks));
                } catch (error) {
                    console.error('Error saving:', error);
                }
            }, [homeworks]);

            useEffect(() => {
                try {
                    localStorage.setItem('notifications_v3', JSON.stringify(notifications));
                } catch (error) {
                    console.error('Error saving:', error);
                }
            }, [notifications]);

            // Gamification functions
            const getStudentStats = (studentCode) => {
                const savedStats = localStorage.getItem(`student_stats_${studentCode}`);
                if (savedStats) {
                    return JSON.parse(savedStats);
                }
                
                return {
                    code: studentCode,
                    points: 0,
                    badges: [],
                    loginDates: [],
                    streak: 0,
                    totalLogins: 0,
                    completedHomeworks: 0,
                    totalHomeworks: 0
                };
            };

            const saveStudentStats = (stats) => {
                localStorage.setItem(`student_stats_${stats.code}`, JSON.stringify(stats));
            };

            const recordLogin = (studentCode) => {
                const stats = getStudentStats(studentCode);
                const today = new Date().toISOString().split('T')[0];
                
                if (!stats.loginDates.includes(today)) {
                    stats.loginDates.push(today);
                    stats.totalLogins++;
                    
                    // Award first login badge
                    if (stats.totalLogins === 1 && !stats.badges.includes('FIRST_LOGIN')) {
                        stats.badges.push('FIRST_LOGIN');
                        stats.points += BADGES.FIRST_LOGIN.points;
                        setNewBadgeEarned('FIRST_LOGIN');
                    }
                    
                    // Check for early bird
                    const hour = new Date().getHours();
                    if (hour < 8 && !stats.badges.includes('EARLY_BIRD')) {
                        stats.badges.push('EARLY_BIRD');
                        stats.points += BADGES.EARLY_BIRD.points;
                        setNewBadgeEarned('EARLY_BIRD');
                    }
                    
                    // Calculate streak
                    stats.streak = calculateStreak(stats.loginDates);
                    
                    // Award streak badges
                    if (stats.streak >= 7 && !stats.badges.includes('WEEK_STREAK')) {
                        stats.badges.push('WEEK_STREAK');
                        stats.points += BADGES.WEEK_STREAK.points;
                        setNewBadgeEarned('WEEK_STREAK');
                    }
                    
                    if (stats.streak >= 30 && !stats.badges.includes('MONTH_STREAK')) {
                        stats.badges.push('MONTH_STREAK');
                        stats.points += BADGES.MONTH_STREAK.points;
                        setNewBadgeEarned('MONTH_STREAK');
                    }
                    
                    saveStudentStats(stats);
                    setStudentStats(stats);
                }
            };

            const calculateStreak = (loginDates) => {
                if (!loginDates || loginDates.length === 0) return 0;
                
                const sortedDates = [...loginDates].sort((a, b) => new Date(b) - new Date(a));
                let streak = 1;
                
                for (let i = 0; i < sortedDates.length - 1; i++) {
                    const date1 = new Date(sortedDates[i]);
                    const date2 = new Date(sortedDates[i + 1]);
                    const diffDays = Math.floor((date1 - date2) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            };

            const getAllStudentsStats = () => {
                const allStats = [];
                for (let code in DB) {
                    const stats = getStudentStats(code);
                    if (stats.totalLogins > 0) {
                        allStats.push({
                            ...stats,
                            name: DB[code].name
                        });
                    }
                }
                return allStats.sort((a, b) => b.points - a.points);
            };

            // Password management
            const getSavedPasswords = () => {
                const saved = localStorage.getItem('student_passwords');
                return saved ? JSON.parse(saved) : {};
            };

            const savePassword = (code, password) => {
                const passwords = getSavedPasswords();
                passwords[code] = password;
                localStorage.setItem('student_passwords', JSON.stringify(passwords));
            };

            const checkIfHasPassword = (code) => {
                const passwords = getSavedPasswords();
                return passwords[code] !== undefined;
            };

            const verifyPassword = (code, password) => {
                const passwords = getSavedPasswords();
                return passwords[code] === password;
            };

            // Login handlers
            const handleStep1 = () => {
                if (loginCode.startsWith('T-')) {
                    setUserRole('teacher');
                    setCurrentUser({ name: 'Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯', code: loginCode });
                    setShowLogin(false);
                    return;
                } else if (loginCode.startsWith('P-')) {
                    setUserRole('parent');
                    setCurrentUser({ 
                        name: 'ÙˆØ§Ù„Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨', 
                        code: loginCode,
                        children:[
                    {name:'Ø£Ø­Ù…Ø¯ ÙÙˆØ§Ø² Ø¨Ù† Ø³Ø¹Ø¯ÙˆÙ† Ø§Ù„Ø­Ø±Ø¨ÙŠ',gradeLevel:'first',section:'1',code:'S1-101'},
                    {name:'Ø£Ø­Ù…Ø¯ Ø¯Ø¹ÙŠØ¬ Ø¹ÙˆÙŠØ¶ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',gradeLevel:'second',section:'1',code:'S2-101'},
                    {name:'Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø´Ø¯Ø§Ø¯ Ø§Ù„Ø­ÙŠØ³ÙˆÙ†ÙŠ',gradeLevel:'third',section:'1',code:'S3-101'},
                ]
                    });
                    setShowLogin(false);
                    return;
                } else if (loginCode.startsWith('A-')) {
                    setUserRole('admin');
                    setCurrentUser({ name: 'Ø§Ù„Ù…Ø´Ø±Ù', code: loginCode });
                    setShowLogin(false);
                    return;
                } else if (loginCode.startsWith('S-')) {
                    const account = DB[loginCode];
                    
                    if (!account) {
                        alert('âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­');
                        return;
                    }
                    
                    setAccountData(account);
                    const hasPassword = checkIfHasPassword(loginCode);
                    
                    if (hasPassword) {
                        setLoginStep(2);
                    } else {
                        setLoginStep(3);
                    }
                } else {
                    alert('âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­');
                }
            };

            const handleStep2 = () => {
                if (verifyPassword(loginCode, password)) {
                    setUserRole('student');
                    setCurrentUser({
                        name: accountData.name,
                        code: loginCode,
                        gradeLevel: accountData.gradeLevel,
                        section: accountData.section
                    });
                    
                    // Record login and update stats
                    recordLogin(loginCode);
                    
                    setShowLogin(false);
                    resetLoginForm();
                } else {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            };

            const handleStep3Verification = () => {
                if (verificationCode === accountData.verificationCode) {
                    setLoginStep(4);
                } else {
                    alert('âŒ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­');
                }
            };

            const handleStep4SetPassword = () => {
                if (password.length < 6) {
                    alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                    return;
                }
                
                savePassword(loginCode, password);
                
                setUserRole('student');
                setCurrentUser({
                    name: accountData.name,
                    code: loginCode,
                    gradeLevel: accountData.gradeLevel,
                    section: accountData.section
                });
                
                // Record first login
                recordLogin(loginCode);
                
                setShowLogin(false);
                resetLoginForm();
                
                alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!\nØ­ØµÙ„Øª Ø¹Ù„Ù‰ Ø´Ø§Ø±Ø© "Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ„" ğŸ¯');
            };

            const resetLoginForm = () => {
                setLoginStep(1);
                setLoginCode('');
                setVerificationCode('');
                setPassword('');
                setConfirmPassword('');
                setAccountData(null);
            };

            const handleBackToStep1 = () => {
                resetLoginForm();
            };

            // Get students for class
            const getClassStudents = (gradeLevel, section) => {
                const students = [];
                for (let code in DB) {
                    const acc = DB[code];
                    if (acc.gradeLevel === gradeLevel && acc.section === section) {
                        students.push({
                            id: code,
                            name: acc.name
                        });
                    }
                }
                return students;
            };

            const handleAddHomework = () => {
                if (!newHomework.title || !newHomework.dueDate || !newHomework.dueTime) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                    return;
                }

                const students = getClassStudents(newHomework.gradeLevel, newHomework.section);

                const homework = {
                    id: Date.now(),
                    ...newHomework,
                    createdAt: new Date().toISOString(),
                    status: 'active',
                    teacherName: currentUser.name,
                    teacherCode: currentUser.code,
                    studentCompletions: students.map(s => ({
                        studentId: s.id,
                        studentName: s.name,
                        completed: null
                    }))
                };

                setHomeworks([...homeworks, homework]);
                
                setNewHomework({
                    title: '',
                    description: '',
                    dueDate: '',
                    dueTime: '',
                    grade: '',
                    gradeLevel: 'first',
                    section: '1',
                    type: 'homework'
                });

                students.forEach(student => {
                    addNotification({
                        type: 'new_homework',
                        message: `Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©: ${homework.title}`,
                        homeworkId: homework.id,
                        forStudent: student.id
                    });
                });

                alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!\nØ¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.length}`);
            };

            const openCompletionModal = (homework) => {
                setSelectedHomework(homework);
                setIncompleteStudents([]);
                setShowCompletionModal(true);
            };

            const toggleStudentInIncomplete = (studentId) => {
                if (incompleteStudents.includes(studentId)) {
                    setIncompleteStudents(incompleteStudents.filter(id => id !== studentId));
                } else {
                    setIncompleteStudents([...incompleteStudents, studentId]);
                }
            };

            const handleCloseHomework = () => {
                if (!selectedHomework) return;

                setHomeworks(homeworks.map(hw => {
                    if (hw.id === selectedHomework.id) {
                        return {
                            ...hw,
                            status: 'closed',
                            closedAt: new Date().toISOString(),
                            studentCompletions: hw.studentCompletions.map(sc => ({
                                ...sc,
                                completed: !incompleteStudents.includes(sc.studentId)
                            }))
                        };
                    }
                    return hw;
                }));

                selectedHomework.studentCompletions.forEach(sc => {
                    const completed = !incompleteStudents.includes(sc.studentId);
                    addNotification({
                        type: 'homework_closed',
                        message: completed ? `ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ù…Ø©: ${selectedHomework.title}` : `Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ù…Ø©: ${selectedHomework.title}`,
                        homeworkId: selectedHomework.id,
                        forStudent: sc.studentId,
                        completed: completed
                    });
                    
                    // Update student stats
                    if (completed) {
                        const stats = getStudentStats(sc.studentId);
                        stats.completedHomeworks++;
                        stats.totalHomeworks++;
                        stats.points += 5;
                        
                        // Check for homework master badge
                        const completionRate = stats.completedHomeworks / stats.totalHomeworks;
                        if (completionRate >= 0.9 && stats.totalHomeworks >= 10 && !stats.badges.includes('HOMEWORK_MASTER')) {
                            stats.badges.push('HOMEWORK_MASTER');
                            stats.points += BADGES.HOMEWORK_MASTER.points;
                        }
                        
                        saveStudentStats(stats);
                    }
                });

                setShowCompletionModal(false);
                setSelectedHomework(null);
                setIncompleteStudents([]);
                alert('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            };

            const handleSendInquiry = (homeworkId, inquiry) => {
                const homework = homeworks.find(hw => hw.id === homeworkId);
                addNotification({
                    type: 'inquiry',
                    message: `Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ù† ${currentUser.name}: ${inquiry}`,
                    homeworkId: homeworkId,
                    forTeacher: homework.teacherCode,
                    studentName: currentUser.name,
                    studentCode: currentUser.code
                });
                alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ù„Ù„Ù…Ø¹Ù„Ù…');
            };

            const addNotification = (notification) => {
                setNotifications([...notifications, { 
                    ...notification, 
                    id: Date.now() + Math.random(), 
                    read: false, 
                    createdAt: new Date().toISOString()
                }]);
            };

            const getFilteredNotifications = () => {
                if (userRole === 'teacher') {
                    return notifications.filter(n => n.forTeacher === currentUser.code);
                } else if (userRole === 'student') {
                    return notifications.filter(n => n.forStudent === currentUser.code);
                } else if (userRole === 'parent') {
                    const childrenCodes = currentUser.students.map(s => s.code);
                    return notifications.filter(n => childrenCodes.includes(n.forStudent));
                }
                return [];
            };

            const getFilteredHomeworks = () => {
                if (userRole === 'teacher') {
                    return homeworks.filter(hw => hw.teacherCode === currentUser.code);
                } else if (userRole === 'student') {
                    return homeworks.filter(hw => 
                        hw.gradeLevel === currentUser.gradeLevel && 
                        hw.section === currentUser.section
                    );
                } else if (userRole === 'parent') {
                    return homeworks.filter(hw => 
                        currentUser.students.some(student => 
                            hw.gradeLevel === student.gradeLevel && 
                            hw.section === student.section
                        )
                    );
                }
                return [];
            };

            const formatDate = (dateStr, timeStr) => {
                const date = new Date(`${dateStr}T${timeStr}`);
                return date.toLocaleDateString('ar-SA', { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }) + ' - ' + timeStr;
            };

            const getTimeRemaining = (dateStr, timeStr) => {
                const now = new Date();
                const due = new Date(`${dateStr}T${timeStr}`);
                const diff = due - now;
                
                if (diff < 0) return 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ù…ÙˆØ¹Ø¯';
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                if (days > 0) return `Ø¨Ø§Ù‚ÙŠ ${days} ÙŠÙˆÙ…`;
                if (hours > 0) return `Ø¨Ø§Ù‚ÙŠ ${hours} Ø³Ø§Ø¹Ø©`;
                return 'ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹!';
            };

            const getStudentCompletion = (homework, studentCode) => {
                const completion = homework.studentCompletions?.find(sc => sc.studentId === studentCode);
                return completion;
            };

            const getUpcomingHomeworks = () => {
                return getFilteredHomeworks().filter(hw => {
                    if (hw.status !== 'active') return false;
                    const dueDate = new Date(`${hw.dueDate}T${hw.dueTime}`);
                    const now = new Date();
                    const hoursUntilDue = (dueDate - now) / (1000 * 60 * 60);
                    return hoursUntilDue > 0 && hoursUntilDue <= 72; // Next 3 days
                }).sort((a, b) => {
                    const dateA = new Date(`${a.dueDate}T${a.dueTime}`);
                    const dateB = new Date(`${b.dueDate}T${b.dueTime}`);
                    return dateA - dateB;
                });
            };

            // Badge earned modal
            useEffect(() => {
                if (newBadgeEarned) {
                    setTimeout(() => setNewBadgeEarned(null), 5000);
                }
            }, [newBadgeEarned]);

            // Load student stats when logged in as student
            useEffect(() => {
                if (userRole === 'student' && currentUser) {
                    const stats = getStudentStats(currentUser.code);
                    setStudentStats(stats);
                }
            }, [userRole, currentUser]);

            // Login Screen (keeping previous code but shortened for space)
            if (showLogin) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="w-16 h-16 bg-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <span className="text-white text-3xl">ğŸ”</span>
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</h1>
                                <p className="text-gray-600">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… - Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</p>
                            </div>

                            {/* Login steps code (same as before, keeping compact) */}
                            {loginStep === 1 && (
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„
                                        </label>
                                        <input
                                            type="text"
                                            value={loginCode}
                                            onChange={(e) => setLoginCode(e.target.value.toUpperCase())}
                                            placeholder="Ù…Ø«Ø§Ù„: S-101"
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-center text-lg font-mono"
                                            onKeyPress={(e) => e.key === 'Enter' && handleStep1()}
                                        />
                                    </div>
                                    <button onClick={handleStep1} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg">
                                        Ø§Ù„ØªØ§Ù„ÙŠ â†
                                    </button>
                                    <div className="mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
                                        <p className="font-semibold mb-2">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</p>
                                        <p className="text-xs">Ù…Ø¹Ù„Ù…: T-001 | Ø·Ø§Ù„Ø¨: S-101 | ÙˆÙ„ÙŠ Ø£Ù…Ø±: P-001</p>
                                    </div>
                                </div>
                            )}

                            {loginStep === 2 && (
                                <div className="space-y-4">
                                    <div className="bg-green-50 border-r-4 border-green-500 p-3 mb-4">
                                        <p className="text-sm">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {accountData?.name}</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="w-full px-4 py-3 border rounded-lg"
                                            onKeyPress={(e) => e.key === 'Enter' && handleStep2()}
                                            autoFocus
                                        />
                                    </div>
                                    <button onClick={handleStep2} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg">
                                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                                    </button>
                                    <button onClick={handleBackToStep1} className="w-full bg-gray-200 text-gray-700 py-2 rounded-lg text-sm">
                                        â† Ø±Ø¬ÙˆØ¹
                                    </button>
                                </div>
                            )}

                            {loginStep === 3 && (
                                <div className="space-y-4">
                                    <div className="bg-blue-50 border-r-4 border-blue-500 p-3 mb-4">
                                        <p className="text-sm">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {accountData?.name}</p>
                                        <p className="text-xs text-blue-600 mt-2 font-semibold">
                                            ğŸ‰ Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ùƒ!
                                        </p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©)</label>
                                        <input
                                            type="text"
                                            value={verificationCode}
                                            onChange={(e) => setVerificationCode(e.target.value)}
                                            maxLength="4"
                                            className="w-full px-4 py-3 border rounded-lg text-center text-2xl font-mono tracking-widest"
                                            onKeyPress={(e) => e.key === 'Enter' && handleStep3Verification()}
                                            autoFocus
                                        />
                                    </div>
                                    <button onClick={handleStep3Verification} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg">
                                        Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© â†’
                                    </button>
                                    <button onClick={handleBackToStep1} className="w-full bg-gray-200 text-gray-700 py-2 rounded-lg text-sm">
                                        â† Ø±Ø¬ÙˆØ¹
                                    </button>
                                </div>
                            )}

                            {loginStep === 4 && (
                                <div className="space-y-4">
                                    <div className="bg-green-50 border-r-4 border-green-500 p-3 mb-4">
                                        <p className="text-sm text-green-700 font-semibold">âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚!</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                                            className="w-full px-4 py-3 border rounded-lg mb-3"
                                            autoFocus
                                        />
                                        <input
                                            type="password"
                                            value={confirmPassword}
                                            onChange={(e) => setConfirmPassword(e.target.value)}
                                            placeholder="Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                                            className="w-full px-4 py-3 border rounded-lg"
                                            onKeyPress={(e) => e.key === 'Enter' && handleStep4SetPassword()}
                                        />
                                    </div>
                                    <button onClick={handleStep4SetPassword} className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg">
                                        âœ“ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Main App
            return (
                <div className="min-h-screen bg-gray-50">
                    {/* New Badge Earned Modal */}
                    {newBadgeEarned && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 badge-animation">
                            <div className="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center">
                                <div className="text-6xl mb-4">{BADGES[newBadgeEarned].icon}</div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-2">Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯!</h2>
                                <p className="text-lg text-indigo-600 font-semibold mb-2">{BADGES[newBadgeEarned].name}</p>
                                <p className="text-sm text-gray-600 mb-4">{BADGES[newBadgeEarned].description}</p>
                                <p className="text-green-600 font-bold">+{BADGES[newBadgeEarned].points} Ù†Ù‚Ø·Ø©</p>
                            </div>
                        </div>
                    )}

                    {/* Leaderboard Modal */}
                    {showLeaderboard && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h2>
                                    <button
                                        onClick={() => setShowLeaderboard(false)}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        âœ•
                                    </button>
                                </div>
                                
                                <div className="space-y-3">
                                    {getAllStudentsStats().map((student, idx) => (
                                        <div 
                                            key={student.code}
                                            className={`p-4 rounded-lg flex items-center gap-4 ${
                                                idx === 0 ? 'bg-gradient-to-r from-yellow-100 to-yellow-50 border-2 border-yellow-400' :
                                                idx === 1 ? 'bg-gradient-to-r from-gray-100 to-gray-50 border-2 border-gray-400' :
                                                idx === 2 ? 'bg-gradient-to-r from-orange-100 to-orange-50 border-2 border-orange-400' :
                                                'bg-gray-50'
                                            }`}
                                        >
                                            <div className="text-2xl font-bold w-8">
                                                {idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : `${idx + 1}`}
                                            </div>
                                            <div className="flex-1">
                                                <p className="font-semibold text-gray-800">{student.name}</p>
                                                <div className="flex items-center gap-4 text-xs text-gray-600 mt-1">
                                                    <span>ğŸ”¥ {student.streak} ÙŠÙˆÙ…</span>
                                                    <span>ğŸ“Š {student.points} Ù†Ù‚Ø·Ø©</span>
                                                    <span>ğŸ–ï¸ {student.badges.length} Ø´Ø§Ø±Ø©</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {getAllStudentsStats().length === 0 && (
                                        <p className="text-center text-gray-500 py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Badges Modal */}
                    {showBadges && studentStats && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">ğŸ–ï¸ Ø´Ø§Ø±Ø§ØªÙŠ</h2>
                                    <button
                                        onClick={() => setShowBadges(false)}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        âœ•
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    {Object.keys(BADGES).map(badgeKey => {
                                        const badge = BADGES[badgeKey];
                                        const earned = studentStats.badges.includes(badgeKey);
                                        
                                        return (
                                            <div 
                                                key={badgeKey}
                                                className={`p-4 rounded-lg text-center ${
                                                    earned ? 'bg-gradient-to-br from-indigo-100 to-purple-100 border-2 border-indigo-400' : 'bg-gray-100 opacity-50'
                                                }`}
                                            >
                                                <div className="text-4xl mb-2">{badge.icon}</div>
                                                <p className="font-bold text-sm mb-1">{badge.name}</p>
                                                <p className="text-xs text-gray-600 mb-2">{badge.description}</p>
                                                <p className="text-xs font-bold text-indigo-600">+{badge.points} Ù†Ù‚Ø·Ø©</p>
                                                {!earned && (
                                                    <p className="text-xs text-gray-500 mt-2">ğŸ”’ Ù…ÙÙ‚ÙÙ„</p>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    <header className="bg-indigo-600 text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <span className="text-3xl">ğŸ“š</span>
                                <div>
                                    <h1 className="text-xl font-bold">Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ù†Ø°Ø± Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ</h1>
                                    <p className="text-sm text-indigo-200">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {currentUser.name}</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                {userRole === 'student' && studentStats && (
                                    <div className="flex items-center gap-3">
                                        <button
                                            onClick={() => setShowLeaderboard(true)}
                                            className="px-3 py-1 bg-indigo-700 hover:bg-indigo-800 rounded-lg text-sm flex items-center gap-1"
                                        >
                                            ğŸ† Ø§Ù„ØµØ¯Ø§Ø±Ø©
                                        </button>
                                        <button
                                            onClick={() => setShowBadges(true)}
                                            className="px-3 py-1 bg-indigo-700 hover:bg-indigo-800 rounded-lg text-sm flex items-center gap-1"
                                        >
                                            ğŸ–ï¸ {studentStats.badges.length}
                                        </button>
                                        <div className="px-3 py-1 bg-indigo-700 rounded-lg text-sm flex items-center gap-2">
                                            {studentStats.streak > 0 && (
                                                <span className="streak-fire">ğŸ”¥</span>
                                            )}
                                            <span>{studentStats.streak}</span>
                                        </div>
                                        <div className="px-3 py-1 bg-yellow-500 rounded-lg text-sm font-bold">
                                            â­ {studentStats.points}
                                        </div>
                                    </div>
                                )}
                                
                                <button
                                    onClick={() => setShowNotifications(!showNotifications)}
                                    className="relative p-2 hover:bg-indigo-700 rounded-lg"
                                >
                                    <span className="text-2xl">ğŸ””</span>
                                    {getFilteredNotifications().filter(n => !n.read).length > 0 && (
                                        <span className="absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs">
                                            {getFilteredNotifications().filter(n => !n.read).length}
                                        </span>
                                    )}
                                </button>

                                <button
                                    onClick={() => {
                                        setShowLogin(true);
                                        setCurrentUser(null);
                                        setUserRole(null);
                                        setStudentStats(null);
                                        resetLoginForm();
                                    }}
                                    className="px-4 py-2 bg-indigo-700 hover:bg-indigo-800 rounded-lg text-sm"
                                >
                                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                                </button>
                            </div>
                        </div>
                    </header>

                    {showNotifications && (
                        <div className="fixed top-20 left-4 bg-white rounded-lg shadow-2xl p-4 w-80 max-h-96 overflow-y-auto z-50">
                            <h3 className="font-bold text-lg mb-3">
                                ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ({getFilteredNotifications().length})
                            </h3>
                            {getFilteredNotifications().length === 0 ? (
                                <p className="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</p>
                            ) : (
                                <div className="space-y-2">
                                    {getFilteredNotifications().slice().reverse().map(notif => (
                                        <div key={notif.id} className={`p-3 rounded-lg text-sm border-r-4 ${
                                            notif.type === 'inquiry' ? 'bg-yellow-50 border-yellow-500' :
                                            notif.completed === false ? 'bg-red-50 border-red-500' :
                                            notif.completed === true ? 'bg-green-50 border-green-500' :
                                            'bg-indigo-50 border-indigo-500'
                                        }`}>
                                            <p className="text-gray-800">{notif.message}</p>
                                            <p className="text-xs text-gray-500 mt-1">
                                                {new Date(notif.createdAt).toLocaleString('ar-SA')}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto px-4 py-8">
                        {/* Student Dashboard with Gamification */}
                        {userRole === 'student' && studentStats && (
                            <div className="space-y-6">
                                {/* Stats Cards */}
                                <div className="grid md:grid-cols-4 gap-4">
                                    <div className="bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-xl p-6 text-white">
                                        <div className="text-3xl mb-2">â­</div>
                                        <p className="text-2xl font-bold">{studentStats.points}</p>
                                        <p className="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-orange-400 to-red-500 rounded-xl p-6 text-white">
                                        <div className="text-3xl mb-2 streak-fire">ğŸ”¥</div>
                                        <p className="text-2xl font-bold">{studentStats.streak}</p>
                                        <p className="text-sm opacity-90">Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl p-6 text-white">
                                        <div className="text-3xl mb-2">ğŸ–ï¸</div>
                                        <p className="text-2xl font-bold">{studentStats.badges.length}</p>
                                        <p className="text-sm opacity-90">Ø§Ù„Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</p>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl p-6 text-white">
                                        <div className="text-3xl mb-2">âœ…</div>
                                        <p className="text-2xl font-bold">{studentStats.completedHomeworks}</p>
                                        <p className="text-sm opacity-90">Ù…Ù‡Ø§Ù… Ù…Ù†Ø¬Ø²Ø©</p>
                                    </div>
                                </div>

                                {/* Upcoming Homeworks Alert */}
                                {getUpcomingHomeworks().length > 0 && (
                                    <div className="bg-orange-50 border-r-4 border-orange-500 p-4 rounded-lg">
                                        <h3 className="font-bold text-orange-800 mb-2">
                                            ğŸ“Œ Ù„Ø¯ÙŠÙƒ {getUpcomingHomeworks().length} Ù…Ù‡Ø§Ù… Ù‚Ø§Ø¯Ù…Ø©
                                        </h3>
                                        <div className="space-y-2">
                                            {getUpcomingHomeworks().slice(0, 3).map(hw => (
                                                <div key={hw.id} className="text-sm text-gray-700 flex items-center gap-2">
                                                    <span>{homeworkTypes.find(t => t.value === hw.type)?.label}</span>
                                                    <span>â€¢</span>
                                                    <span>{hw.title}</span>
                                                    <span>â€¢</span>
                                                    <span className="text-orange-600 font-medium">
                                                        {getTimeRemaining(hw.dueDate, hw.dueTime)}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Regular homework list continues... */}
                                <div className="bg-white rounded-xl shadow-md p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-6">Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h2>
                                    {getFilteredHomeworks().length === 0 ? (
                                        <p className="text-center text-gray-500 py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</p>
                                    ) : (
                                        <div className="space-y-4">
                                            {getFilteredHomeworks().map(hw => {
                                                const myCompletion = getStudentCompletion(hw, currentUser.code);
                                                const isClosed = hw.status === 'closed';

                                                return (
                                                    <div key={hw.id} className={`border rounded-lg p-4 ${
                                                        isClosed 
                                                            ? myCompletion?.completed ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'
                                                            : 'border-indigo-200 bg-indigo-50'
                                                    }`}>
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <h3 className="text-lg font-semibold">{hw.title}</h3>
                                                            <span className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full">
                                                                {homeworkTypes.find(t => t.value === hw.type)?.label}
                                                            </span>
                                                            {isClosed && myCompletion && (
                                                                <span className={`px-2 py-1 text-xs rounded-full ${
                                                                    myCompletion.completed ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                                                                }`}>
                                                                    {myCompletion.completed ? 'âœ“ Ù…Ù†Ø¬Ø²' : 'âœ— ØºÙŠØ± Ù…Ù†Ø¬Ø²'}
                                                                </span>
                                                            )}
                                                        </div>
                                                        <p className="text-sm text-gray-600 mb-2">{hw.description}</p>
                                                        <div className="flex gap-3 text-xs text-gray-500">
                                                            <span>ğŸ“… {formatDate(hw.dueDate, hw.dueTime)}</span>
                                                            {hw.grade && <span className="text-indigo-600">ğŸ¯ {hw.grade}</span>}
                                                            <span className={!isClosed ? 'text-orange-600' : ''}>
                                                                â° {getTimeRemaining(hw.dueDate, hw.dueTime)}
                                                            </span>
                                                        </div>
                                                        
                                                        {!isClosed && (
                                                            <button
                                                                onClick={() => {
                                                                    const inquiry = prompt('Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ:');
                                                                    if (inquiry) handleSendInquiry(hw.id, inquiry);
                                                                }}
                                                                className="text-indigo-600 hover:text-indigo-700 text-sm font-medium mt-2"
                                                            >
                                                                âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙØ³Ø§Ø±
                                                            </button>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Teacher/Parent interfaces remain the same */}
                        {(userRole === 'teacher' || userRole === 'parent') && (
                            <div className="text-center py-12">
                                <p className="text-gray-600">
                                    {userRole === 'teacher' ? 'ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù… - ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…' : 'ÙˆØ§Ø¬Ù‡Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± - Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¨Ù†Ø§Ø¦Ùƒ'}
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').style.display = 'block';
        });

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('install-prompt').style.display = 'none';
            }
        });

        document.getElementById('dismiss-btn').addEventListener('click', () => {
            document.getElementById('install-prompt').style.display = 'none';
        });

        ReactDOM.render(<HomeworkApp />, document.getElementById('root'));
    </script>
</body>
</html>
