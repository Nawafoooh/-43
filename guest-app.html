<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÖÿ∂ŸäŸÅŸä ÿßŸÑÿ∞ŸÉŸä - Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÜÿ≤ŸäŸÑ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2563eb; --primary-hover: #1d4ed8; --success: #10b981;
            --warning: #f59e0b; --danger: #ef4444; --bg: #f8fafc; --text: #1e293b;
            --border: #e2e8f0; --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Tajawal', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: var(--text); line-height: 1.6; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow);
            text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 2rem; color: var(--primary); margin-bottom: 10px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px;
            border-radius: 15px; box-shadow: var(--shadow); }
        .tab-btn { flex: 1; padding: 15px; background: transparent; border: none;
            font-family: 'Tajawal', sans-serif; font-size: 1rem; font-weight: 600;
            color: #64748b; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .tab-btn:hover { background: var(--bg); color: var(--primary); }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: white; border-radius: 20px; padding: 30px; box-shadow: var(--shadow); }
        .card-header { margin-bottom: 25px; border-bottom: 2px solid var(--border); padding-bottom: 15px; }
        .card-header h2 { font-size: 1.5rem; color: var(--text); margin-bottom: 5px; }
        .card-header p { color: #64748b; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--text); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px;
            border: 2px solid var(--border); border-radius: 10px; font-family: 'Tajawal', sans-serif;
            font-size: 1rem; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .counter { display: flex; align-items: center; gap: 15px; max-width: 200px; }
        .counter-btn { width: 50px; height: 50px; border: 2px solid var(--primary);
            background: white; color: var(--primary); font-size: 1.5rem; font-weight: bold;
            border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .counter-btn:hover { background: var(--primary); color: white; }
        .counter input { width: 80px; text-align: center; font-size: 1.2rem; font-weight: 600; }
        .radio-group { display: flex; gap: 15px; }
        .radio-option { flex: 1; padding: 12px; border: 2px solid var(--border); border-radius: 10px;
            cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .radio-option:hover { border-color: var(--primary); background: rgba(37, 99, 235, 0.05); }
        .radio-option input[type="radio"] { margin-left: 8px; }
        .file-upload { display: flex; align-items: center; gap: 15px; padding: 20px;
            border: 2px dashed var(--border); border-radius: 10px; background: var(--bg); }
        .upload-btn { padding: 10px 20px; background: var(--primary); color: white; border: none;
            border-radius: 8px; font-family: 'Tajawal', sans-serif; font-weight: 600; cursor: pointer; }
        .upload-btn:hover { background: var(--primary-hover); }
        .file-name { color: #64748b; font-size: 0.9rem; }
        .congestion { padding: 15px; border-radius: 10px; margin-top: 10px; margin-bottom: 15px; display: none; }
        .congestion.show { display: block; }
        .congestion.low { background: #d1fae5; border-right: 4px solid var(--success); color: #065f46; }
        .congestion.medium { background: #fef3c7; border-right: 4px solid var(--warning); color: #92400e; }
        .congestion.high { background: #fee2e2; border-right: 4px solid var(--danger); color: #991b1b; }
        .btn-primary { width: 100%; padding: 15px 30px; border: none; border-radius: 12px;
            font-family: 'Tajawal', sans-serif; font-size: 1.1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s; background: var(--primary); color: white;
            box-shadow: var(--shadow); margin-top: 15px; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .request-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; margin: 20px 0; }
        .request-btn { padding: 20px; border: 2px solid var(--border); background: white;
            border-radius: 12px; cursor: pointer; transition: all 0.3s; display: flex;
            flex-direction: column; align-items: center; gap: 10px; }
        .request-btn:hover { border-color: var(--primary); background: rgba(37, 99, 235, 0.05);
            transform: translateY(-4px); box-shadow: var(--shadow); }
        .request-btn.active { border-color: var(--primary); background: var(--primary); color: white; }
        .request-btn .icon { font-size: 2.5rem; }
        .request-btn span:last-child { font-weight: 600; font-size: 1rem; }
        .request-details { margin-top: 20px; padding: 20px; background: var(--bg);
            border-radius: 12px; display: none; }
        .request-details.show { display: block; }
        .chatbot { margin-top: 30px; padding: 20px; background: var(--bg); border-radius: 15px; }
        .chatbot-header { text-align: center; margin-bottom: 15px; }
        .chatbot-header h3 { font-size: 1.3rem; color: var(--text); }
        .chat-messages { height: 300px; overflow-y: auto; padding: 15px; background: white;
            border-radius: 12px; margin-bottom: 15px; }
        .chat-message { padding: 12px; margin-bottom: 10px; border-radius: 12px; max-width: 80%;
            animation: slideIn 0.3s; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); } }
        .bot-message { background: var(--primary); color: white; margin-left: 0; margin-right: auto; }
        .user-message { background: var(--bg); color: var(--text); margin-right: 0; margin-left: auto; }
        .quick-questions { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .quick-q-btn { padding: 8px 15px; background: white; border: 2px solid var(--border);
            border-radius: 20px; font-family: 'Tajawal', sans-serif; font-size: 0.9rem;
            cursor: pointer; transition: all 0.3s; }
        .quick-q-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .chat-input-area { display: flex; gap: 10px; }
        .chat-input-area input { flex: 1; padding: 12px; border: 2px solid var(--border);
            border-radius: 12px; font-family: 'Tajawal', sans-serif; }
        .chat-input-area button { padding: 12px 20px; background: var(--primary); color: white;
            border: none; border-radius: 12px; font-family: 'Tajawal', sans-serif;
            font-weight: 600; cursor: pointer; }
        .chat-input-area button:hover { background: var(--primary-hover); }
        .invoice { padding: 20px; background: var(--bg); border-radius: 12px; margin: 20px 0; }
        .invoice h3 { margin-bottom: 15px; color: var(--text); }
        .invoice-item { display: flex; justify-content: space-between; padding: 10px 0;
            border-bottom: 1px solid var(--border); }
        .invoice-item.total { font-weight: 700; font-size: 1.2rem; color: var(--primary);
            border-bottom: none; margin-top: 10px; }
        .invoice-note { margin-top: 15px; font-size: 0.9rem; color: #64748b; font-style: italic; }
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(50%);
            background: var(--text); color: white; padding: 15px 30px; border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); z-index: 2000; display: none;
            animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translate(50%, 50px); opacity: 0; }
            to { transform: translate(50%, 0); opacity: 1; } }
        .toast.show { display: block; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .request-buttons { grid-template-columns: repeat(2, 1fr); }
            .card { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè® ŸÖÿ∂ŸäŸÅŸä ÿßŸÑÿ∞ŸÉŸä</h1>
            <p>ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÜÿµÿ© ÿßŸÑŸÜÿ≤ŸÑÿßÿ°</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="arrival">ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸàÿµŸàŸÑ</button>
            <button class="tab-btn" data-tab="departure">ÿ¨ÿØŸàŸÑÿ© ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©</button>
            <button class="tab-btn" data-tab="requests">ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</button>
        </div>

        <div id="arrivalTab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2>üìÖ ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑÿ∞ŸÉŸäÿ©</h2>
                    <p>ÿ≥ÿßÿπÿØŸÜÿß ŸÅŸä ÿ™ÿ¨ŸáŸäÿ≤ ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑŸÉ ÿßŸÑŸÖÿ´ÿßŸÑŸä</p>
                </div>
                <form id="arrivalForm">
                    <div class="form-group">
                        <label>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤</label>
                        <input type="text" id="bookingNumber" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤" required>
                    </div>
                    <div class="form-group">
                        <label>ÿßÿ≥ŸÖ ÿßŸÑŸÜÿ≤ŸäŸÑ</label>
                        <input type="text" id="guestName" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ" required>
                    </div>
                    <div class="form-group">
                        <label>‚è∞ ŸàŸÇÿ™ ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑŸÖÿ™ŸàŸÇÿπ</label>
                        <select id="arrivalTime" required>
                            <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸàŸÇÿ™</option>
                        </select>
                    </div>
                    <div id="congestionIndicator" class="congestion"></div>
                    <div class="form-group">
                        <label>üöó Ÿàÿ≥ŸäŸÑÿ© ÿßŸÑŸÜŸÇŸÑ</label>
                        <select id="transportType" required>
                            <option value="">ÿßÿÆÿ™ÿ± Ÿàÿ≥ŸäŸÑÿ© ÿßŸÑŸÜŸÇŸÑ</option>
                            <option value="taxi">ÿ™ÿßŸÉÿ≥Ÿä</option>
                            <option value="private">ÿ≥Ÿäÿßÿ±ÿ© ÿÆÿßÿµÿ©</option>
                        </select>
                    </div>
                    <div class="form-group" id="plateNumberGroup" style="display: none;">
                        <label>üî¢ ÿ±ŸÇŸÖ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≥Ÿäÿßÿ±ÿ©</label>
                        <input type="text" id="plateNumber" placeholder="ŸÖÿ´ÿßŸÑ: ÿ£ ÿ® ÿ¨ 1234">
                    </div>
                    <div class="form-group">
                        <label>üß≥ ÿπÿØÿØ ÿßŸÑÿ≠ŸÇÿßÿ¶ÿ®</label>
                        <div class="counter">
                            <button type="button" class="counter-btn" data-action="decrease" data-target="luggageCount">-</button>
                            <input type="number" id="luggageCount" value="1" min="0" max="10" readonly>
                            <button type="button" class="counter-btn" data-action="increase" data-target="luggageCount">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>üì∏ ÿµŸàÿ±ÿ© ÿßŸÑŸáŸàŸäÿ©</label>
                        <div class="file-upload">
                            <input type="file" id="idUpload" accept="image/*" style="display: none;">
                            <button type="button" class="upload-btn" onclick="document.getElementById('idUpload').click()">üìÅ ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ©</button>
                            <span id="fileName" class="file-name">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ</span>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸàÿµŸàŸÑ ‚úàÔ∏è</button>
                </form>
            </div>
        </div>

        <div id="departureTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>üö™ ÿ¨ÿØŸàŸÑÿ© ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©</h2>
                    <p>ŸÜÿ∏ŸÖ ŸÖŸàÿπÿØ ŸÖÿ∫ÿßÿØÿ±ÿ™ŸÉ ÿ®ÿ≥ŸáŸàŸÑÿ©</p>
                </div>
                <form id="departureForm">
                    <div class="form-group">
                        <label>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤</label>
                        <input type="text" id="departureBookingNumber" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤" required>
                    </div>
                    <div class="form-group">
                        <label>‚è∞ ŸàŸÇÿ™ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑŸÖÿ™ŸàŸÇÿπ</label>
                        <select id="departureTime" required>
                            <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸàŸÇÿ™</option>
                        </select>
                    </div>
                    <div id="departureCongestionIndicator" class="congestion"></div>
                    <div class="form-group">
                        <label>üíº ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßŸÑÿ≠ŸÇÿßÿ¶ÿ®ÿü</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="luggageHelp" value="yes">
                                <span>ŸÜÿπŸÖ</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="luggageHelp" value="no" checked>
                                <span>ŸÑÿß</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group" id="departureLuggageGroup" style="display: none;">
                        <label>ÿπÿØÿØ ÿßŸÑÿ≠ŸÇÿßÿ¶ÿ®</label>
                        <div class="counter">
                            <button type="button" class="counter-btn" data-action="decrease" data-target="departureLuggageCount">-</button>
                            <input type="number" id="departureLuggageCount" value="1" min="1" max="10" readonly>
                            <button type="button" class="counter-btn" data-action="increase" data-target="departureLuggageCount">+</button>
                        </div>
                    </div>
                    <div class="invoice">
                        <h3>üìã ŸÖŸÑÿÆÿµ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©</h3>
                        <div class="invoice-item"><span>ÿπÿØÿØ ÿßŸÑŸÑŸäÿßŸÑŸä:</span><span>3 ŸÑŸäÿßŸÑŸä</span></div>
                        <div class="invoice-item"><span>ÿ≥ÿπÿ± ÿßŸÑŸÑŸäŸÑÿ©:</span><span>500 ÿ±ŸäÿßŸÑ</span></div>
                        <div class="invoice-item total"><span>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</span><span>1,500 ÿ±ŸäÿßŸÑ</span></div>
                        <p class="invoice-note">* ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© ÿ≥ÿ™ŸÉŸàŸÜ ÿπŸÜÿØ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©</p>
                    </div>
                    <button type="submit" class="btn-primary">ÿ™ÿ£ŸÉŸäÿØ ŸÖŸàÿπÿØ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ© üöÄ</button>
                </form>
            </div>
        </div>

        <div id="requestsTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>üõéÔ∏è ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</h2>
                    <p>ŸÜÿ≠ŸÜ ŸáŸÜÿß ŸÑÿÆÿØŸÖÿ™ŸÉ ÿπŸÑŸâ ŸÖÿØÿßÿ± ÿßŸÑÿ≥ÿßÿπÿ©</p>
                </div>
                <div class="form-group">
                    <label>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ / ÿ±ŸÇŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©</label>
                    <input type="text" id="requestBookingNumber" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ÿ£Ÿà ÿßŸÑÿ∫ÿ±ŸÅÿ©">
                </div>
                <div class="request-buttons">
                    <button class="request-btn" data-request="cleaning">
                        <span class="icon">üßπ</span>
                        <span>ÿ∑ŸÑÿ® ÿ™ŸÜÿ∏ŸäŸÅ</span>
                    </button>
                    <button class="request-btn" data-request="supplies">
                        <span class="icon">üß¥</span>
                        <span>ÿ∑ŸÑÿ® ŸÖÿ≥ÿ™ŸÑÿ≤ŸÖÿßÿ™</span>
                    </button>
                    <button class="request-btn" data-request="maintenance">
                        <span class="icon">üîß</span>
                        <span>ÿ®ŸÑÿßÿ∫ ÿµŸäÿßŸÜÿ©</span>
                    </button>
                    <button class="request-btn" data-request="food">
                        <span class="icon">üçΩÔ∏è</span>
                        <span>ÿ∑ŸÑÿ® ÿ∑ÿπÿßŸÖ</span>
                    </button>
                    <button class="request-btn" data-request="other">
                        <span class="icon">üí¨</span>
                        <span>ÿ∑ŸÑÿ® ÿ¢ÿÆÿ±</span>
                    </button>
                </div>
                <div id="requestDetails" class="request-details">
                    <textarea id="requestNotes" placeholder="ÿßŸÉÿ™ÿ® ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ® ŸáŸÜÿß..." rows="4" style="width:100%;padding:12px;border:2px solid var(--border);border-radius:10px;font-family:'Tajawal',sans-serif;"></textarea>
                    <button id="submitRequest" class="btn-primary">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® üì§</button>
                </div>
                <div class="chatbot">
                    <div class="chatbot-header">
                        <h3>ü§ñ ÿßŸÑŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ¢ŸÑŸä</h3>
                        <p>ÿßÿ≥ÿ£ŸÑŸÜŸä ÿ£Ÿä ÿ¥Ÿäÿ°!</p>
                    </div>
                    <div id="chatMessages" class="chat-messages">
                        <div class="chat-message bot-message">ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü</div>
                    </div>
                    <div class="quick-questions">
                        <button class="quick-q-btn" data-question="ŸÖÿß ŸáŸä ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±ÿü">üç≥ ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±</button>
                        <button class="quick-q-btn" data-question="ÿ£ŸäŸÜ ŸÖŸàŸÇŸÅ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ÿü">üöó ŸÖŸàŸÇŸÅ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™</button>
                        <button class="quick-q-btn" data-question="ŸÉŸäŸÅ ÿ£ÿ™ÿµŸÑ ÿ®ÿßŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑÿü">üìû ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ</button>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ ŸáŸÜÿß...">
                        <button id="sendChatBtn">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="toast" class="toast"></div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDld4NfSWqA5EKYLXo08NpeCewpICYbDLI",
            authDomain: "mudeefy-smart-hotel.firebaseapp.com",
            projectId: "mudeefy-smart-hotel",
            storageBucket: "mudeefy-smart-hotel.firebasestorage.app",
            messagingSenderId: "776841372805",
            appId: "1:776841372805:web:2d248105748b49975175ec"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast show ${type}`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab + 'Tab').classList.add('active');
            });
        });

        const times = [];
        for (let h = 12; h <= 23; h++) {
            for (let m = 0; m < 60; m += 30) {
                const time = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
                const display = new Date(`2000-01-01T${time}`).toLocaleTimeString('ar-SA', {hour: '2-digit', minute: '2-digit', hour12: true});
                times.push({ value: time, display });
            }
        }
        times.forEach(t => {
            ['arrivalTime', 'departureTime'].forEach(id => {
                const opt = document.createElement('option');
                opt.value = t.value;
                opt.textContent = t.display;
                document.getElementById(id).appendChild(opt);
            });
        });

        document.getElementById('transportType').addEventListener('change', e => {
            document.getElementById('plateNumberGroup').style.display = e.target.value === 'private' ? 'block' : 'none';
        });

        async function updateCongestion(time, type) {
            const ind = document.getElementById(type === 'arrival' ? 'congestionIndicator' : 'departureCongestionIndicator');
            if (!time) { ind.classList.remove('show'); return; }
            const today = new Date().toISOString().split('T')[0];
            const col = type === 'arrival' ? 'arrivals' : 'departures';
            const field = type === 'arrival' ? 'arrivalTime' : 'departureTime';
            const q = query(collection(db, col), where('date', '==', today), where(field, '==', time));
            const snap = await getDocs(q);
            const count = snap.size;
            let msg, cls;
            if (count === 0) { msg = '‚úÖ ÿ∫Ÿäÿ± ŸÖÿ≤ÿØÿ≠ŸÖ - ŸàŸÇÿ™ ŸÖŸÖÿ™ÿßÿ≤'; cls = 'low'; }
            else if (count <= 2) { msg = `‚ö†Ô∏è ÿßÿ≤ÿØÿ≠ÿßŸÖ ŸÖÿ™Ÿàÿ≥ÿ∑ - ${count} ÿ≠ÿ¨ÿ≤`; cls = 'medium'; }
            else { msg = `üö® ŸÖÿ≤ÿØÿ≠ŸÖ - ${count} ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™`; cls = 'high'; }
            ind.textContent = msg;
            ind.className = `congestion show ${cls}`;
        }

        document.getElementById('arrivalTime').addEventListener('change', e => updateCongestion(e.target.value, 'arrival'));
        document.getElementById('departureTime').addEventListener('change', e => updateCongestion(e.target.value, 'departure'));

        document.querySelectorAll('.counter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = document.getElementById(btn.dataset.target);
                let val = parseInt(input.value);
                if (btn.dataset.action === 'increase' && val < parseInt(input.max)) input.value = val + 1;
                if (btn.dataset.action === 'decrease' && val > parseInt(input.min)) input.value = val - 1;
            });
        });

        document.getElementById('idUpload').addEventListener('change', e => {
            document.getElementById('fileName').textContent = e.target.files.length ? e.target.files[0].name : 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ';
        });

        document.getElementById('arrivalForm').addEventListener('submit', async e => {
            e.preventDefault();
            try {
                const booking = document.getElementById('bookingNumber').value;
                const name = document.getElementById('guestName').value;
                const time = document.getElementById('arrivalTime').value;
                const transport = document.getElementById('transportType').value;
                const plate = document.getElementById('plateNumber').value;
                const luggage = parseInt(document.getElementById('luggageCount').value);
                const file = document.getElementById('idUpload').files[0];
                let url = null;
                if (file) {
                    const storageRef = ref(storage, `id-images/${booking}-${Date.now()}`);
                    const snap = await uploadBytes(storageRef, file);
                    url = await getDownloadURL(snap.ref);
                }
                await addDoc(collection(db, 'arrivals'), {
                    bookingNumber: booking, guestName: name, arrivalTime: time, transportType: transport,
                    plateNumber: transport === 'private' ? plate : null, luggageCount: luggage, idImageUrl: url,
                    status: 'ŸÇÿßÿØŸÖ', createdAt: Timestamp.now(), date: new Date().toISOString().split('T')[0]
                });
                showToast('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸàÿµŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠! ‚úàÔ∏è', 'success');
                e.target.reset();
                document.getElementById('fileName').textContent = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ';
                document.getElementById('congestionIndicator').classList.remove('show');
            } catch (err) {
                showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.', 'error');
            }
        });

        document.querySelectorAll('input[name="luggageHelp"]').forEach(radio => {
            radio.addEventListener('change', () => {
                document.getElementById('departureLuggageGroup').style.display = 
                    document.querySelector('input[name="luggageHelp"]:checked').value === 'yes' ? 'block' : 'none';
            });
        });

        document.getElementById('departureForm').addEventListener('submit', async e => {
            e.preventDefault();
            try {
                const booking = document.getElementById('departureBookingNumber').value;
                const time = document.getElementById('departureTime').value;
                const help = document.querySelector('input[name="luggageHelp"]:checked').value;
                const count = help === 'yes' ? parseInt(document.getElementById('departureLuggageCount').value) : 0;
                await addDoc(collection(db, 'departures'), {
                    bookingNumber: booking, departureTime: time, luggageHelp: help === 'yes', luggageCount: count,
                    status: 'ŸÖÿ¨ÿØŸàŸÑ', createdAt: Timestamp.now(), date: new Date().toISOString().split('T')[0]
                });
                showToast('ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ŸÖŸàÿπÿØ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠! üöÄ', 'success');
                e.target.reset();
                document.getElementById('departureCongestionIndicator').classList.remove('show');
                document.getElementById('departureLuggageGroup').style.display = 'none';
            } catch (err) {
                showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.', 'error');
            }
        });

        let selectedType = null;
        document.querySelectorAll('.request-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.request-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedType = btn.dataset.request;
                document.getElementById('requestDetails').classList.add('show');
            });
        });

        document.getElementById('submitRequest').addEventListener('click', async () => {
            const booking = document.getElementById('requestBookingNumber').value;
            const notes = document.getElementById('requestNotes').value;
            if (!booking || !selectedType) { showToast('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸàÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ∑ŸÑÿ®', 'warning'); return; }
            try {
                const types = {cleaning:'üßπ ÿ∑ŸÑÿ® ÿ™ŸÜÿ∏ŸäŸÅ',supplies:'üß¥ ÿ∑ŸÑÿ® ŸÖÿ≥ÿ™ŸÑÿ≤ŸÖÿßÿ™',maintenance:'üîß ÿ®ŸÑÿßÿ∫ ÿµŸäÿßŸÜÿ©',food:'üçΩÔ∏è ÿ∑ŸÑÿ® ÿ∑ÿπÿßŸÖ',other:'üí¨ ÿ∑ŸÑÿ® ÿ¢ÿÆÿ±'};
                await addDoc(collection(db, 'requests'), {
                    bookingNumber: booking, type: selectedType, typeDisplay: types[selectedType], notes,
                    status: 'new', statusDisplay: 'ÿ¨ÿØŸäÿØ', assignedTo: null, createdAt: Timestamp.now(),
                    assignedAt: null, completedAt: null, responseTime: null, completionTime: null
                });
                showToast('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠! üõéÔ∏è', 'success');
                document.getElementById('requestNotes').value = '';
                document.getElementById('requestDetails').classList.remove('show');
                document.querySelectorAll('.request-btn').forEach(b => b.classList.remove('active'));
            } catch (err) {
                showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£', 'error');
            }
        });

        const faq = {
            'ŸÖÿß ŸáŸä ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±': 'Ÿäÿ™ŸÖ ÿ™ŸÇÿØŸäŸÖ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸÖŸÜ 7:00 ÿµÿ®ÿßÿ≠ÿßŸã ÿ≠ÿ™Ÿâ 11:00 ÿµÿ®ÿßÿ≠ÿßŸã ŸÅŸä ÿßŸÑŸÖÿ∑ÿπŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä.',
            'ÿ£ŸäŸÜ ŸÖŸàŸÇŸÅ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™': 'ŸÖŸàŸÇŸÅ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ ŸäŸÇÿπ ŸÅŸä ÿßŸÑÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ≥ŸÅŸÑŸä (B1). ÿßŸÑŸÖŸàÿßŸÇŸÅ ŸÖÿ™ÿßÿ≠ÿ© ŸÖÿ¨ÿßŸÜÿßŸã.',
            'ŸÉŸäŸÅ ÿ£ÿ™ÿµŸÑ ÿ®ÿßŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ': 'ÿßÿ∂ÿ∫ÿ∑ 0 ŸÖŸÜ Ÿáÿßÿ™ŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ©ÿå ÿ£Ÿà ÿßÿ™ÿµŸÑ ÿπŸÑŸâ: 0555-123-4567'
        };

        function handleChat(msg) {
            if (!msg.trim()) return;
            const msgs = document.getElementById('chatMessages');
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user-message';
            userMsg.textContent = msg;
            msgs.appendChild(userMsg);
            msgs.scrollTop = msgs.scrollHeight;
            setTimeout(() => {
                let answer = 'ÿπÿ∞ÿ±ÿßŸãÿå ŸÑŸÖ ÿ£ŸÅŸáŸÖ ÿ≥ÿ§ÿßŸÑŸÉ. ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©. üìû';
                for (let q in faq) {
                    if (msg.includes(q) || q.includes(msg)) { answer = faq[q]; break; }
                }
                const botMsg = document.createElement('div');
                botMsg.className = 'chat-message bot-message';
                botMsg.textContent = answer;
                msgs.appendChild(botMsg);
                msgs.scrollTop = msgs.scrollHeight;
            }, 500);
        }

        document.getElementById('sendChatBtn').addEventListener('click', () => {
            handleChat(document.getElementById('chatInput').value);
            document.getElementById('chatInput').value = '';
        });

        document.getElementById('chatInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') {
                handleChat(e.target.value);
                e.target.value = '';
            }
        });

        document.querySelectorAll('.quick-q-btn').forEach(btn => {
            btn.addEventListener('click', () => handleChat(btn.dataset.question));
        });
    </script>
</body>
</html>
