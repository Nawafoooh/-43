<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة حصص الانتظار المدرسية الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .tab-inactive { color: #4a5568; }
        .tab-inactive:hover { background-color: #f7fafc; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification { animation: slideIn 0.3s ease-out; }
        .priority-1 { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-right: 4px solid #10b981; }
        .priority-2 { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-right: 4px solid #f59e0b; }
        .priority-3 { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-right: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">نظام إدارة حصص الانتظار الذكي</h1>
                        <p class="text-gray-600">نظام ذكي لاختيار معلمي الانتظار حسب الأولويات والشروط</p>
                    </div>
                </div>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="saveAllData()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                        حفظ
                    </button>
                    <button onclick="initializeSystem()" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        تهيئة
                    </button>
                    <button onclick="clearAllData()" class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        مسح الكل
                    </button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="hidden mb-4 p-4 rounded-lg notification"></div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex flex-col md:flex-row border-b">
                <button onclick="switchTab('teachers')" id="tab-teachers" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 font-semibold transition tab-active">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    المعلمين
                </button>
                <button onclick="switchTab('schedule')" id="tab-schedule" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 font-semibold transition tab-inactive">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    الجدول المدرسي
                </button>
                <button onclick="switchTab('smart-substitution')" id="tab-smart-substitution" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 font-semibold transition tab-inactive">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    النظام الذكي
                </button>
                <button onclick="switchTab('absences')" id="tab-absences" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 font-semibold transition tab-inactive">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    سجل الانتظار
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <!-- Teachers Tab -->
            <div id="content-teachers" class="tab-content">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">قائمة المعلمين وأولويات الانتظار</h2>
                    <div class="flex gap-2">
                        <button onclick="addTeacher()" class="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">إضافة معلم</button>
                        <button onclick="generatePriorityReport()" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">تقرير الأولويات</button>
                    </div>
                </div>
                <div id="teachers-list" class="grid gap-4"></div>
            </div>

            <!-- Schedule Tab -->
            <div id="content-schedule" class="tab-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">الجدول المدرسي</h2>
                    <button onclick="addScheduleEntry()" class="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">إضافة حصة</button>
                </div>
                <div class="overflow-x-auto">
                    <div id="schedule-list"></div>
                </div>
            </div>

            <!-- Smart Substitution Tab -->
            <div id="content-smart-substitution" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-lg border border-green-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">🤖 نظام الانتظار الذكي</h2>
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded-lg shadow">
                                <h3 class="font-bold text-lg text-green-700 mb-2">تعيين انتظار تلقائي</h3>
                                <p class="text-gray-600 mb-3 text-sm">سيقوم النظام باختيار أفضل معلم للانتظار حسب الشروط المحددة</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">اليوم</label>
                                        <select id="substitution-day" class="w-full p-2 border border-gray-300 rounded-lg">
                                            <option value="الأحد">الأحد</option>
                                            <option value="الاثنين">الاثنين</option>
                                            <option value="الثلاثاء">الثلاثاء</option>
                                            <option value="الأربعاء">الأربعاء</option>
                                            <option value="الخميس">الخميس</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">الحصة</label>
                                        <select id="substitution-period" class="w-full p-2 border border-gray-300 rounded-lg">
                                            <option value="1">الحصة 1</option>
                                            <option value="2">الحصة 2</option>
                                            <option value="3">الحصة 3</option>
                                            <option value="4">الحصة 4</option>
                                            <option value="5">الحصة 5</option>
                                            <option value="6">الحصة 6</option>
                                            <option value="7">الحصة 7</option>
                                        </select>
                                    </div>
                                </div>
                                <button onclick="findBestSubstitute()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold">
                                    🔍 ابحث عن أفضل معلم للانتظار
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white p-6 rounded-lg shadow border">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">📊 نتائج البحث</h3>
                            <div id="substitution-results" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">سيظهر هنا أفضل المعلمين للانتظار حسب الشروط</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- شروط النظام -->
                <div class="mt-6 bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                    <h3 class="text-lg font-bold text-yellow-800 mb-3">📋 شروط نظام الانتظار الذكي</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-yellow-700">
                        <div class="flex items-start gap-2">
                            <span class="bg-yellow-200 rounded-full px-2 py-1 text-xs font-bold">1</span>
                            <span>لا يأخذ المعلم أكثر من انتظار واحد في اليوم</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-yellow-200 rounded-full px-2 py-1 text-xs font-bold">2</span>
                            <span>الأولوية لمن لم يأخذ انتظار في الأيام السابقة</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-yellow-200 rounded-full px-2 py-1 text-xs font-bold">3</span>
                            <span>مراعاة عدد حصص الانتظار المطلوبة لكل معلم</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-yellow-200 rounded-full px-2 py-1 text-xs font-bold">4</span>
                            <span>المعلم المشغول في نفس الحصة لا يدخل الانتظار</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Absences Tab -->
            <div id="content-absences" class="tab-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">سجل حصص الانتظار</h2>
                    <button onclick="exportAbsencesReport()" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        تصدير تقرير
                    </button>
                </div>
                <div id="absences-list" class="space-y-4"></div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <div>
                        <p class="text-gray-600 text-sm">عدد المعلمين</p>
                        <p id="stat-teachers" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="text-gray-600 text-sm">عدد الحصص</p>
                        <p id="stat-schedule" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <div>
                        <p class="text-gray-600 text-sm">حصص الانتظار</p>
                        <p id="stat-absences" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="text-gray-600 text-sm">النظام</p>
                        <p class="text-3xl font-bold text-gray-800">🚀</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let teachers = [];
        let schedule = [];
        let absences = [];

        // بيانات حصص الانتظار المطلوبة لكل معلم
        const teacherSubstitutionRequirements = {
            "عبدالهادي معيض الشاماني": 3,
            "عبيد بن دخيل العياضي الحربي": 1,
            "علي متعب العلوي الحربي": 0,
            "فهد عويض الشاماني الحربي": 7,
            "فؤاد بن محمد العتيبي": 0,
            "فيصل عطالله الصاعدي": 10,
            "محمد بن ذعار العوفي": 2,
            "محمد بن عماري الزهراني": 4,
            "محمد عياد العوفي": 9,
            "مشعل بن هليل العمري الحربي": 0,
            "فيصل عواد أبو سلمي": 0,
            "موسى غازي سفر الحربي": 3,
            "موفق مرزوق السحيمي": 9,
            "نافع شعوي المطيري": 3,
            "نميان علي الحربي": 7,
            "ابراهيم عايض الجابري": 10,
            "ابراهيم عياد العلوي": 5,
            "أحمد إبراهيم التركي": 8,
            "أحمد حامد الحربي": 0,
            "اسامه منور العوفي": 3,
            "بدر عبدالعزيز السحيمي": 11,
            "حبيب علي العمري الحربي": 7,
            "حمزة صدقة اسلام": 0,
            "ساير فيصل العضيله المطيري": 0,
            "سعد طالع الحربي": 10,
            "سلطان عويض السحيمي": 8,
            "سلمان صالح الحارثي": 11,
            "سيف عبدالمنعم العارضي": 3,
            "عبدالعزيز عبدالرحمن غلاب المخلفي": 0,
            "عبدالعزيز مفلح الرويثي": 9,
            "عبدالله بن محمد القرني": 3,
            "عبدالله بن مطر العمري": 8,
            "عبدالله حمود الحربي": 0,
            "عبدالله صلاح الرحيلى": 0,
            "كاتب مفلح الرشيدى": 3,
            "نواف منصور الصبحي": 3,
            "موسى مسعود الحيسوني": 3,
            "فواز زايد المهيمزي الرشيدي": 1
        };

        // قائمة المعلمين
        const excelTeachers = [
            "عبدالله بن مطر العمري",
            "محمد بن عماري الزهراني",
            "موفق مرزوق السحيمي",
            "فواز زايد المهيمزي الرشيدي",
            "فيصل عطالله الصاعدي",
            "ابراهيم عياد العلوي",
            "عبدالله حمود الحربي",
            "ساير فيصل العضيله المطيري",
            "نافع شعوي المطيري",
            "اسامه منور العوفي",
            "محمد عياد العوفي",
            "أحمد إبراهيم التركي",
            "أحمد حامد الحربي",
            "نميان علي الحربي",
            "عبدالله صلاح الرحيلى",
            "مشعل بن هليل العمري الحربي",
            "علي متعب العلوي الحربي",
            "سيف عبدالمنعم العارضي",
            "محمد بن ذعار العوفي",
            "فؤاد بن محمد العتيبي",
            "حمزة صدقة اسلام",
            "سلمان صالح الحارثي",
            "عبيد بن دخيل العياضي الحربي",
            "عبدالعزيز مفلح الرويثي",
            "فيصل عواد أبو سلمي",
            "عبدالله بن محمد القرني",
            "كاتب مفلح الرشيدى",
            "حبيب علي العمري الحربي",
            "ابراهيم عايض الجابري",
            "سلطان عويض السحيمي",
            "عبدالهادي معيض الشاماني",
            "عبدالعزيز عبدالرحمن غلاب المخلفي",
            "سعد طالع الحربي",
            "موسى غازي سفر الحربي",
            "موسى مسعود الحيسوني",
            "نواف منصور الصبحي",
            "بدر عبدالعزيز السحيمي",
            "فهد عويض الشاماني الحربي"
        ];

        // تهيئة النظام
        function initializeSystem() {
            if (confirm('هل تريد تهيئة النظام بجميع المعلمين (38 معلم) وبيانات الانتظار؟')) {
                teachers = [];
                excelTeachers.forEach(name => {
                    teachers.push({
                        id: Date.now() + Math.random(),
                        name: name,
                        subject: "غير محدد",
                        substituteCount: 0,
                        requiredSubstitutions: teacherSubstitutionRequirements[name] || 0,
                        dailySubstitutions: {} // تتبع الانتظار اليومي
                    });
                });
                renderTeachers();
                updateStats();
                saveAllData();
                showNotification(`تم تهيئة النظام بنجاح مع ${teachers.length} معلم 🎉`, 'success');
            }
        }

        // حفظ البيانات
        function saveAllData() {
            localStorage.setItem('teachers', JSON.stringify(teachers));
            localStorage.setItem('schedule', JSON.stringify(schedule));
            localStorage.setItem('absences', JSON.stringify(absences));
            showNotification('تم حفظ البيانات بنجاح ✓', 'success');
        }

        // تحميل البيانات
        function loadData() {
            const savedTeachers = localStorage.getItem('teachers');
            const savedSchedule = localStorage.getItem('schedule');
            const savedAbsences = localStorage.getItem('absences');

            if (savedTeachers) {
                teachers = JSON.parse(savedTeachers);
                teachers.forEach(t => {
                    t.requiredSubstitutions = teacherSubstitutionRequirements[t.name] || 0;
                    t.dailySubstitutions = t.dailySubstitutions || {};
                });
            }
            if (savedSchedule) schedule = JSON.parse(savedSchedule);
            if (savedAbsences) absences = JSON.parse(savedAbsences);

            renderAll();
        }

        // مسح البيانات
        function clearAllData() {
            if (confirm('هل أنت متأكد من حذف جميع البيانات؟ ⚠️')) {
                teachers = [];
                schedule = [];
                absences = [];
                localStorage.clear();
                renderAll();
                showNotification('تم حذف جميع البيانات', 'success');
            }
        }

        // إظهار الإشعارات
        function showNotification(message, type) {
                        const notification = document.getElementById('notification');
            notification.className = `notification p-4 rounded-lg mb-4 ${type === 'success' ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="text-lg">${type === 'success' ? '✅' : '⚠️'}</span>
                    <span class="font-semibold">${message}</span>
                </div>
            `;
            notification.classList.remove('hidden');
            setTimeout(() => notification.classList.add('hidden'), 4000);
        }

        // التنقل بين التبويبات
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.remove('tab-active'));
            document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.add('tab-inactive'));

            document.getElementById(`content-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('tab-inactive');
        }

        // عرض المعلمين
        function renderTeachers() {
            const list = document.getElementById('teachers-list');
            if (!teachers.length) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">لا يوجد معلمين مضافين بعد</p>';
                return;
            }

            list.innerHTML = teachers.map(teacher => `
                <div class="bg-gradient-to-r from-gray-50 to-white p-4 rounded-lg shadow border-l-4 border-indigo-500">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800">${teacher.name}</h3>
                            <p class="text-sm text-gray-600">${teacher.subject}</p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
                                    انتظار مكتمل: ${teacher.substituteCount} / ${teacher.requiredSubstitutions}
                                </span>
                                <span class="px-2 py-1 ${teacher.substituteCount >= teacher.requiredSubstitutions ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'} rounded-full text-xs font-medium">
                                    ${teacher.substituteCount >= teacher.requiredSubstitutions ? '✅ اكتمل' : '⏳ قيد التنفيذ'}
                                </span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editTeacher('${teacher.id}')" class="text-blue-600 hover:text-blue-800 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteTeacher('${teacher.id}')" class="text-red-600 hover:text-red-800 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // إضافة معلم
        function addTeacher() {
            const name = prompt('اسم المعلم:');
            if (!name) return;
            const subject = prompt('المادة:') || 'غير محدد';
            const required = parseInt(prompt('عدد حصص الانتظار المطلوبة:')) || 0;

            teachers.push({
                id: Date.now() + Math.random(),
                name,
                subject,
                substituteCount: 0,
                requiredSubstitutions: required,
                dailySubstitutions: {}
            });
            renderTeachers();
            updateStats();
            saveAllData();
            showNotification('تم إضافة المعلم بنجاح ✓', 'success');
        }

        // تعديل معلم
        function editTeacher(id) {
            const teacher = teachers.find(t => t.id == id);
            if (!teacher) return;

            const newName = prompt('اسم المعلم الجديد:', teacher.name);
            if (!newName) return;
            const newSubject = prompt('المادة الجديدة:', teacher.subject) || 'غير محدد';
            const newRequired = parseInt(prompt('عدد حصص الانتظار المطلوبة:', teacher.requiredSubstitutions)) || 0;

            teacher.name = newName;
            teacher.subject = newSubject;
            teacher.requiredSubstitutions = newRequired;
            renderTeachers();
            saveAllData();
            showNotification('تم تعديل المعلم بنجاح ✓', 'success');
        }

        // حذف معلم
        function deleteTeacher(id) {
            if (!confirm('هل أنت متأكد من حذف هذا المعلم؟')) return;
            teachers = teachers.filter(t => t.id != id);
            renderTeachers();
            updateStats();
            saveAllData();
            showNotification('تم حذف المعلم بنجاح ✓', 'success');
        }

        // عرض الجدول
        function renderSchedule() {
            const list = document.getElementById('schedule-list');
            if (!schedule.length) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">لا يوجد حصص مضافة بعد</p>';
                return;
            }

            list.innerHTML = `
                <table class="w-full text-right text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-2">اليوم</th>
                            <th class="p-2">الحصة</th>
                            <th class="p-2">المعلم</th>
                            <th class="p-2">المادة</th>
                            <th class="p-2">الصف</th>
                            <th class="p-2">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${schedule.map(entry => `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="p-2">${entry.day}</td>
                                <td class="p-2">${entry.period}</td>
                                <td class="p-2">${entry.teacher}</td>
                                <td class="p-2">${entry.subject}</td>
                                <td class="p-2">${entry.class}</td>
                                <td class="p-2 flex gap-2">
                                    <button onclick="editScheduleEntry('${entry.id}')" class="text-blue-600 hover:text-blue-800">تعديل</button>
                                    <button onclick="deleteScheduleEntry('${entry.id}')" class="text-red-600 hover:text-red-800">حذف</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // إضافة حصة
        function addScheduleEntry() {
            const day = prompt('اليوم:');
            if (!day) return;
            const period = prompt('رقم الحصة:');
            if (!period) return;
            const teacher = prompt('اسم المعلم:');
            if (!teacher) return;
            const subject = prompt('المادة:') || 'غير محدد';
            const cls = prompt('الصف:') || 'غير محدد';

            schedule.push({
                id: Date.now() + Math.random(),
                day,
                period,
                teacher,
                subject,
                class: cls
            });
            renderSchedule();
            updateStats();
            saveAllData();
            showNotification('تم إضافة الحصة بنجاح ✓', 'success');
        }

        // تعديل حصة
        function editScheduleEntry(id) {
            const entry = schedule.find(s => s.id == id);
            if (!entry) return;

            const newDay = prompt('اليوم الجديد:', entry.day);
            if (!newDay) return;
            const newPeriod = prompt('رقم الحصة الجديد:', entry.period);
            if (!newPeriod) return;
            const newTeacher = prompt('اسم المعلم الجديد:', entry.teacher);
            if (!newTeacher) return;
            const newSubject = prompt('المادة الجديدة:', entry.subject) || 'غير محدد';
            const newClass = prompt('الصف الجديد:', entry.class) || 'غير محدد';

            entry.day = newDay;
            entry.period = newPeriod;
            entry.teacher = newTeacher;
            entry.subject = newSubject;
            entry.class = newClass;
            renderSchedule();
            saveAllData();
            showNotification('تم تعديل الحصة بنجاح ✓', 'success');
        }

        // حذف حصة
        function deleteScheduleEntry(id) {
            if (!confirm('هل أنت متأكد من حذف هذه الحصة؟')) return;
            schedule = schedule.filter(s => s.id != id);
            renderSchedule();
            updateStats();
            saveAllData();
            showNotification('تم حذف الحصة بنجاح ✓', 'success');
        }

        // البحث عن أفضل معلم للانتظار
        function findBestSubstitute() {
            const day = document.getElementById('substitution-day').value;
            const period = document.getElementById('substitution-period').value;

            const available = teachers.filter(t => {
                // لا يأخذ أكثر من انتظار في اليوم
                if (t.dailySubstitutions[day]) return false;
                // لا يكون مشغول في نفس الحصة
                const busy = schedule.some(s => s.day === day && s.period === period && s.teacher === t.name);
                if (busy) return false;
                // لم يكمل حصص الانتظار المطلوبة
                return t.substituteCount < t.requiredSubstitutions;
            });

            // ترتيب حسب الأولوية: الأقل انتظارًا أولاً
            available.sort((a, b) => a.substituteCount - b.substituteCount);

            const results = document.getElementById('substitution-results');
            if (!available.length) {
                results.innerHTML = '<p class="text-red-600 text-center py-4">لا يوجد معلمين متاحين لهذه الحصة</p>';
                return;
            }

            results.innerHTML = available.map((t, i) => `
                <div class="p-3 rounded-lg ${i === 0 ? 'priority-1' : i === 1 ? 'priority-2' : 'priority-3'}">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-gray-800">${t.name}</p>
                            <p class="text-sm text-gray-600">انتظار مكتمل: ${t.substituteCount} / ${t.requiredSubstitutions}</p>
                        </div>
                        <button onclick="assignSubstitute('${t.name}', '${day}', '${period}')" class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 transition text-sm">
                            تعيين
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // تعيين الانتظار
        function assignSubstitute(teacherName, day, period) {
            const teacher = teachers.find(t => t.name === teacherName);
            if (!teacher) return;

            teacher.substituteCount++;
            teacher.dailySubstitutions[day] = true;

            absences.push({
                id: Date.now() + Math.random(),
                teacher: teacherName,
                day,
                period,
                date: new Date().toLocaleDateString('ar-SA')
            });

            saveAllData();
            renderAll();
            showNotification(`تم تعيين ${teacherName} للانتظار بنجاح ✓`, 'success');
            findBestSubstitute(); // تحديث النتائج
        }

        // عرض سجل الانتظار
        function renderAbsences() {
            const list = document.getElementById('absences-list');
            if (!absences.length) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">لا يوجد سجل انتظار بعد</p>';
                return;
            }

            list.innerHTML = absences.map(abs => `
                <div class="bg-white p-4 rounded-lg shadow border-l-4 border-orange-400">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                        <div>
                            <p class="font-bold text-gray-800">${abs.teacher}</p>
                            <p class="text-sm text-gray-600">${abs.day} - الحصة ${abs.period} - ${abs.date}</p>
                        </div>
                        <button onclick="deleteAbsence('${abs.id}')" class="text-red-600 hover:text-red-800 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // حذف سجل انتظار
        function deleteAbsence(id) {
            if (!confirm('هل أنت متأكد من حذف هذا السجل؟')) return;
            const abs = absences.find(a => a.id == id);
            if (abs) {
                const teacher = teachers.find(t => t.name === abs.teacher);
                if (teacher) {
                    teacher.substituteCount--;
                    delete teacher.dailySubstitutions[abs.day];
                }
            }
            absences = absences.filter(a => a.id != id);
            renderAbsences();
            renderTeachers();
            saveAllData();
            showNotification('تم حذف السجل بنجاح ✓', 'success');
        }

        // تصدير تقرير
        function exportAbsencesReport() {
            if (!absences.length) {
                showNotification('لا يوجد بيانات للتصدير', 'error');
                return;
            }

            let csv = 'المعلم,اليوم,الحصة,التاريخ\n';
            absences.forEach(abs => {
                csv += `${abs.teacher},${abs.day},${abs.period},${abs.date}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `تقرير_الانتظار_${new Date().toLocaleDateString('ar-SA')}.csv`;
            link.click();
            showNotification('تم تصدير التقرير بنجاح ✓', 'success');
        }

        // تقرير الأولويات
        function generatePriorityReport() {
            const remaining = teachers.filter(t => t.substituteCount < t.requiredSubstitutions)
                .sort((a, b) => (a.requiredSubstitutions - a.substituteCount) - (b.requiredSubstitutions - b.substituteCount));

            if (!remaining.length) {
                showNotification('جميع المعلمين أكملوا حصص الانتظار المطلوبة ✅', 'success');
                return;
            }

            let report = '📊 تقرير الأولويات:\n\n';
            remaining.forEach((t, i) => {
                report += `${i + 1}. ${t.name} - متبقي: ${t.requiredSubstitutions - t.substituteCount} حصص\n`;
            });

            alert(report);
        }

        // تحديث الإحصائيات
        function updateStats() {
            document.getElementById('stat-teachers').textContent = teachers.length;
            document.getElementById('stat-schedule').textContent = schedule.length;
            document.getElementById('stat-absences').textContent = absences.length;
        }

        // عرض الكل
        function renderAll() {
            renderTeachers();
            renderSchedule();
            renderAbsences();
            updateStats();
        }

        // تهيئة التطبيق
        window.onload = () => {
            loadData();
            renderAll();
        };
    </script>
</body>
</html>
